<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Mynotes/操作系统与系统编程/理解select、poll和epoll区别/理解select、poll和epoll区别 | 恁村扛把子</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="fangsong">
  <meta name="keywords" content="">
  <meta name="description" content="不要尽力而为，而要全力以赴，即使没有出色的外表和能力，也要压倒一切的霸气，用自己的光，照亮自己的路。">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'master',
    version: '1.4.5',
    localsearch:{
      "enable": false,
      "trigger": "auto",
      "top_n_per_article": 1,
      "unescape": false,
      "preload": false
      },
    path: '-'
  };
</script>

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/jquery.min.js"></script>
  <script src="/js/jquery.jside.menu.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "endless-river",
	     });
	}); 
	</script>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300|Noto+Serif+SC&amp;display=swap">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
</head>
<body>
<div class="single">
<div id="page">
<div id="lx-aside" style="background-image: url(/images/page-cover.jpg)" data-stellar-background-ratio="0.5">
  <div class="overlay">
  <div class="page-title">
    <div class="avatar"><a href="/"><img src="/images/fs3.jpg"></a></div>
    <span>2020-05-14</span>
    <h2>Mynotes/操作系统与系统编程/理解select、poll和epoll区别/理解select、poll和epoll区别</h2>
    
    </div>
</div>
</div>
<div id="lx-main-content">
  <div class="lx-post">
    <div class="lx-entry padding">
      <div>
        <h1 id="理解select、poll和epoll区别"><a href="#理解select、poll和epoll区别" class="headerlink" title="理解select、poll和epoll区别"></a>理解select、poll和epoll区别</h1><h2 id="１、IO复用模型"><a href="#１、IO复用模型" class="headerlink" title="１、IO复用模型"></a>１、IO复用模型</h2><p><img src="https://static.dingtalk.com/media/lALPDiQ3KR9S0PHNApTNA5Q_916_660.png_620x10000q90g.jpg?auth_bizType=IM&auth_bizEntity=%7B%22cid%22%3A%22627064533%3A627064533%22%2C%22msgId%22%3A%223484896791903%22%7D&bizType=im&open_id=627064533" alt="图片"></p>
<h2 id="２、目前的常用的IO复用模型有三种：select，poll，epoll"><a href="#２、目前的常用的IO复用模型有三种：select，poll，epoll" class="headerlink" title="２、目前的常用的IO复用模型有三种：select，poll，epoll"></a>２、目前的常用的IO复用模型有三种：select，poll，epoll</h2><p>(1)select时间复杂度O(n)</p>
<p>他仅仅知道有I/O事件发生了，却不知道是哪那几个流(可能有一个，多个，甚至全部),我们只能无差别轮询所有的流，找出能读出数据，或者能写入数据的流，对他们进行操作。所以<font color = red>select具有o(n)无差别轮询的时间复杂度</font>，同时处理的流越多，无差别轮询时间就越长。</p>
<p>(2)poll时间复杂度O(n)</p>
<p>poll本质上与select没有区别,他讲用户传入的数组拷贝到内核空间，然后查询每个fd对应的设备状态，但是<font color = red>它没有最大连接的限制</font>，原因是它给予链表来存储的。</p>
<p>(3)epoll时间复杂度O(1)</p>
<p>epoll可以理解为evnt poll, 不同于忙轮训和无差别轮训,epoll会把那个流发生怎样的I/O时间通知我们。所以我们说epoll实际上是<font color = red>事件驱动(每个事件关联上fd)</font>的，此时我们对这些流的操作都是有意义的,它是红黑树,(复杂度降到了O(1));</p>
<p>select, poll, epoll 都是IO多路复用机制。I/O多路复用就是通过这种机制，可以监视多个描述度，一旦某个描述符就绪(一般是读就绪或者写就绪)，能够通知程序进行相应的读写操作。但select,poll,epoll本质上都是I/O,因为他们都需要在读写时间就绪后自己负责进行读写，也就是说这个读写过程是阻塞的，而异步I/O则无需自己负责进行读写，异步I/O的实现会负责吧数据从内核拷贝到用户空间。</p>
<p>epoll跟select都能提供多路I/O服用的解决方案。在现在的Linux内核中都能够支持，其中epoll是linux所特有，而select则应该是POSIX所规定,一般操作系统均有实现;</p>
<h2 id="３、select、poll、epoll-区别总结："><a href="#３、select、poll、epoll-区别总结：" class="headerlink" title="３、select、poll、epoll 区别总结："></a>３、<strong>select、poll、epoll 区别总结：</strong></h2><h3 id="3-1、支持一个进程所能打开的最大连接数"><a href="#3-1、支持一个进程所能打开的最大连接数" class="headerlink" title="3.1、支持一个进程所能打开的最大连接数"></a>3.1、支持一个进程所能打开的<font color = red>最大连接数</font></h3><p>select：单个进程所能打开的最大连接数有FD_SETSIZE宏定义，其大小是32个整数的大小（在32位的机器上，大小就是32×32，同理64位机器上FD_SETSIZE为32×64），当然我们可以对进行修改，然后重新编译内核，但是性能可能会受到影响，这需要进一步的测试。</p>
<p>poll：poll本质上和select没有区别，但是它没有最大连接数的限制，原因是它是基于链表来存储的。</p>
<p>epoll：虽然连接数有上限，但是很大，1G内存的机器上可以打开10万左右的连接，2G内存的机器可以打开20万左右的连接。</p>
<h3 id="3-2、FD剧增后带来的IO效率问题"><a href="#3-2、FD剧增后带来的IO效率问题" class="headerlink" title="3.2、FD剧增后带来的IO效率问题"></a>3.2、FD剧增后带来的IO<font color = red>效率问题</font></h3><p>select：因为每次调用时都会对连接进行线性遍历，所以随着FD的增加会造成遍历速度慢的“线性下降性能问题”。</p>
<p>poll:    同上。</p>
<p>epoll:    因为epoll内核中实现是根据每个fd上的callback函数实现的，只有活跃的socket才会主动调用callback,所以在活跃socket较少的情况下,使用epoll没有前面两者线性下降的性能问题，但是所有的sockfd都在活跃情况下，可能会出现性能问题。</p>
<h3 id="3-3、消息传递方式"><a href="#3-3、消息传递方式" class="headerlink" title="3.3、消息传递方式"></a>3.3、<font color = red>消息传递方式</font></h3><p>select：内核需要将消息传递到用户空间，都需要内核拷贝动作</p>
<p>poll：同上</p>
<p>epoll：epoll通过内核和用户空间共享一块内存来实现的。</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a><strong>总结：</strong></h3><p>综上，在选择select，poll，epoll时要根据具体的使用场合以及这三种方式的自身特点。</p>
<p><strong>1、表面上看epoll的性能最好，但是在连接数少并且连接都十分活跃的情况下，select和poll的性能可能比epoll好，毕竟epoll的通知机制需要很多函数回调</strong></p>
<p><strong>2、select低效是因为每次它都需要轮询。但低效也是相对的，视情况而定，也可通过良好的设计改善</strong> </p>
<p><img src="https://static.dingtalk.com/media/lALPDhJzr-nhBnbNApPNA8U_965_659.png_620x10000q90g.jpg?auth_bizType=IM&auth_bizEntity=%7B%22cid%22%3A%22627064533%3A627064533%22%2C%22msgId%22%3A%223485696508656%22%7D&bizType=im&open_id=627064533" alt="图片"></p>
<img src="https://static.dingtalk.com/media/lALPDiCpqpJJGZLNAY7NA84_974_398.png_620x10000q90g.jpg?auth_bizType=IM&amp;auth_bizEntity=%7B%22cid%22%3A%22627064533%3A627064533%22%2C%22msgId%22%3A%223505296142785%22%7D&amp;bizType=im&amp;open_id=627064533" alt="图片" style="zoom:150%;" />


      </div>
    </div>
  </div>
</div>
<div class="lx-navigation">
	<div class="lx-cover prev lx-cover-sm" style="background-image: url(/images/footer_1.jpg)">
		<div class="overlay"></div>
		<a class="copy" href="/2020/05/14/Mynotes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/DNS%E5%8D%8F%E8%AE%AE/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Next</span>
						<h3>Mynotes/计算机网络/DNS协议</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
        <div class="lx-cover next lx-cover-sm" style="background-image: url(/images/footer_2.jpg)">
		<div class="overlay"></div>
		<a class="copy" href="/2020/05/14/Mynotes/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/%E7%90%86%E8%A7%A3select%E3%80%81poll%E5%92%8Cepoll%E5%8C%BA%E5%88%AB/README/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Prev</span>
						<h3>Mynotes/操作系统与系统编程/理解select、poll和epoll区别/README</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
</div>
</div>

<footer>
  <div>
  Copyright &copy; 2019.<a href="/">恁村扛把子</a><br>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.blleng.cn" target="_blank">Lx</a><br>
  </div>
</footer>
</div>

<button class="menu-trigger"></button>
<div class="menu">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="/images/fs3.jpg" alt="fangsong"/></a>
          </div>
        </div>
        <div class="row for-name">
          <p>fangsong</p>
          <span class="tagline">Hello, World!</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>首页</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>归档</a></li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-bookmark fa-fw"></i>页面</span>
        <ul>
          <li><a href="/guestbook">留言</a></li>
        <li><a href="/about">关于</a></li>
        </ul>
    </li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-link fa-fw"></i>友链</span>
        <ul>
          <li> <a href="https://www.luogu.org/" target="_blank">luogu</a></li>
        </ul>
    </li>
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="/js/jquery.easing.min.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.stellar.min.js"></script>
<script src="/js/main.js"></script>


</body>
</html>
