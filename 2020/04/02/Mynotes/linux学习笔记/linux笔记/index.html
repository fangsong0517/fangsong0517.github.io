<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        恁村扛把子
    </title>
    <meta name="description" content= 嘿，我是恁村扛把子～这是我的子站，用于展示写的Hexo主题：Coder。欢迎访问！ >
    <meta name="keywords" content= Blog,Hexo,Theme,方嵩,FangSong >
    <link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">
    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="恁村扛把子" type="application/atom+xml">
</head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            Mynotes/linux学习笔记/linux笔记
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p>#　shell基础</p>
<p>[TOC]</p>
<h4 id="第一个SHELL脚本"><a href="#第一个SHELL脚本" class="headerlink" title="第一个SHELL脚本"></a>第一个SHELL脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash  <span class="comment">#下面代码告诉由什么解释</span></span></span><br><span class="line">echo 'Hello HaiZei' ＃简单输出</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash a.sh 或chmod + x a.sh</span><br></pre></td></tr></table></figure>

<h4 id="变量与局部变量"><a href="#变量与局部变量" class="headerlink" title="变量与局部变量"></a>变量与局部变量</h4><ul>
<li>变量的定义：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=12</span><br><span class="line">a=helloword</span><br><span class="line">a=`pwd`</span><br><span class="line">a=$a:a　＃拼接</span><br></pre></td></tr></table></figure>

<p>“$”变量引用,”[]”是用来限制$范围，</p>
<ul>
<li>局部变量：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local a=12</span><br></pre></td></tr></table></figure>

<h4 id="特殊变量"><a href="#特殊变量" class="headerlink" title="特殊变量"></a>特殊变量</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2019-32-11%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2019-41-30%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p>特殊变量列表</p>
<table>
<thead>
<tr>
<th align="center"><strong>变量</strong></th>
<th align="left"><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">$0</td>
<td align="left">当前脚本的文件名</td>
</tr>
<tr>
<td align="center">$n</td>
<td align="left">传递给脚本或函数的参数。n 是一个数字，表示第几个参数。例如，第一个参数是$1，第二个参数是$2。</td>
</tr>
<tr>
<td align="center">$#</td>
<td align="left">传递给脚本或函数的参数个数。</td>
</tr>
<tr>
<td align="center">$*</td>
<td align="left">传递给脚本或函数的所有参数。</td>
</tr>
<tr>
<td align="center">$@</td>
<td align="left">传递给脚本或函数的所有参数。被双引号(“ “)包含时，与 $* 稍有不同，下面将会讲到。</td>
</tr>
<tr>
<td align="center">$?</td>
<td align="left">上个命令的退出状态，或函数的返回值。</td>
</tr>
<tr>
<td align="center">$$</td>
<td align="left">当前 Shell 进程 ID。对于 Shell 脚本，就是这些脚本所在的进程 ID。</td>
</tr>
</tbody></table>
<p>例如，$表示当前 Shell 进程的 ID，即 pid，看下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $$</span><br><span class="line">echo $?</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">29949</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>请看下面的脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo "File Name: $0"</span><br><span class="line">echo "First Parameter : $1"</span><br><span class="line">echo "First Parameter : $2"</span><br><span class="line">echo "Quoted Values: $@"</span><br><span class="line">echo "Quoted Values: $*"</span><br><span class="line">echo "Total Number of Parameters : $#"</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">./test.sh Zara Ali</span></span><br><span class="line">File Name : ./test.sh</span><br><span class="line">First Parameter : Zara</span><br><span class="line">Second Parameter : Ali</span><br><span class="line">Quoted Values: Zara Ali</span><br><span class="line">Quoted Values: Zara Ali</span><br><span class="line">Total Number of Parameters : 2</span><br></pre></td></tr></table></figure>

<p><strong>$* 和 $@ 的区别</strong></p>
<p>$* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号(“ “)包含时，都以”$1” “$2” … “$n” 的形式输出所有参数。</p>
<p>但是当它们被双引号(“ “)包含时，”$*” 会将所有的参数作为一个整体，以”$1 $2 … $n”的形式输出所有参数；”$@” 会将各个参数分开，以”$1” “$2” … “$n” 的形式输出所有参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash </span></span><br><span class="line">echo "\$*=" $*</span><br><span class="line">echo "\"\$\"=" "$*"</span><br><span class="line">echo "\$@=" $@</span><br><span class="line">echo "\"\$@\"=" "$@"</span><br><span class="line"></span><br><span class="line">echo "print each param from \$*"</span><br><span class="line">for var in $*</span><br><span class="line">do</span><br><span class="line">    echo "$var"</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo "print each param from \$@"</span><br><span class="line">for var in $@</span><br><span class="line">do</span><br><span class="line">    echo "$var"</span><br><span class="line">done</span><br><span class="line">echo "print each param from \"\$*\""</span><br><span class="line">for var in "$*"</span><br><span class="line">do</span><br><span class="line">    echo "$var"</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo "print each param from \"\$@\""</span><br><span class="line">for var in "$@"</span><br><span class="line">do</span><br><span class="line">    echo "$var"</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<p>运行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ ./test.sh "a" "b" "c" "d"</span><br><span class="line"><span class="meta">$</span><span class="bash">*= a b c d</span></span><br><span class="line">"$"= a b c d</span><br><span class="line"><span class="meta">$</span><span class="bash">@= a b c d</span></span><br><span class="line">"$@"= a b c d</span><br><span class="line">print each param from $*</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">print each param from $@</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">print each param from "$*"</span><br><span class="line">a b c d</span><br><span class="line">print each param from "$@"</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure>

<h4 id="变量，参数展开"><a href="#变量，参数展开" class="headerlink" title="变量，参数展开"></a>变量，参数展开</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2019-53-34%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p>变量替换可以根据变量的状态（是否为空、是否定义等）来改变它的值</p>
<p>可以使用的变量替换形式：</p>
<table>
<thead>
<tr>
<th align="center">形式</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">${var}</td>
<td align="left">变量本来的值</td>
</tr>
<tr>
<td align="center">${var:-word}</td>
<td align="left">如果变量 var 为空或已被删除(unset)，那么返回 word，但不改变 var 的值</td>
</tr>
<tr>
<td align="center">${var:=word}</td>
<td align="left">如果变量 var 为空或已被删除(unset)，那么返回 word，并将 var 的值设置为 word。</td>
</tr>
<tr>
<td align="center">${var:?message}</td>
<td align="left">如果变量 var 为空或已被删除(unset)，那么将消息 message 送到标 准错误输出，可以用来检测变量 var 是否可以被正常赋值。若此替换出现在 Shell 脚本中，那么脚本将停止运行。</td>
</tr>
<tr>
<td align="center">${var:+word}</td>
<td align="left">如果变量 var 被定义，那么返回 word，但不改变 var 的值。</td>
</tr>
</tbody></table>
<h4 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h4><p>先来看一个使用算术运算符的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line">val=`expr $a + $b`</span><br><span class="line">echo "a + b : $val"</span><br><span class="line"></span><br><span class="line">val=`expr $a - $b`</span><br><span class="line">echo "a - b : $val"</span><br><span class="line"></span><br><span class="line">val=`expr $a \* $b`</span><br><span class="line">echo "a * b : $val"</span><br><span class="line"></span><br><span class="line">val=`expr $b / $a`</span><br><span class="line">echo "b / a : $val"</span><br><span class="line"></span><br><span class="line">val=`expr $b % $a`</span><br><span class="line">echo "b % a : $val"</span><br><span class="line"></span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">   echo "a is equal to b"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a != $b ]</span><br><span class="line">then</span><br><span class="line">   echo "a is not equal to b"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a + b : 30</span><br><span class="line">a - b : -10</span><br><span class="line">a * b : 200</span><br><span class="line">b / a : 2</span><br><span class="line">b % a : 0</span><br><span class="line">a is not equal to b</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>乘号(*)前边必须加反斜杠()才能实现乘法运算；</li>
<li>if…then…fi 是条件语句.</li>
</ul>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
<th align="left">举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">加法</td>
<td align="left"><code>expr $a + $b</code> 结果为 30。</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">减法</td>
<td align="left"><code>expr $a - $b</code> 结果为 10。</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">乘法</td>
<td align="left"><code>expr $a \* $b</code> 结果为  200。</td>
</tr>
<tr>
<td align="left">/</td>
<td align="left">除法</td>
<td align="left"><code>expr $b / $a</code> 结果为 2。</td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">取余</td>
<td align="left"><code>expr $b % $a</code> 结果为 0。</td>
</tr>
<tr>
<td align="left">=</td>
<td align="left">赋值</td>
<td align="left">a=$b 将把变量 b 的值赋给 a。</td>
</tr>
<tr>
<td align="left">==</td>
<td align="left">相等。用于比较两个数字，相同则返回 true。</td>
<td align="left">[ $a == $b ] 返回 false。</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left">不相等。用于比较两个数字，不相同则返回 true。</td>
<td align="left">[ $a != $b ] 返回 true。</td>
</tr>
</tbody></table>
<p>注意：条件表达式要放在方括号之间，并且要有空格，例如 [$a==$b] 是错误的，必须写成 [ $a == $b ]。</p>
<h4 id="字符串展开"><a href="#字符串展开" class="headerlink" title="字符串展开"></a>字符串展开</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2019-54-19%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2019-54-48%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h4 id="输入输出-READ"><a href="#输入输出-READ" class="headerlink" title="输入输出-READ"></a>输入输出-READ</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-26-40%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h4 id="输入输出-ECHO"><a href="#输入输出-ECHO" class="headerlink" title="输入输出-ECHO"></a>输入输出-ECHO</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-27-54%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p>如果表达式中包含特殊字符，Shell 将会进行替换。例如，在双引号中使用变量就是一种替换，转义字符也是一种替换。</p>
<p>举个例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">echo -e "Value of a is $a \n"</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Value of a is 10</span><br></pre></td></tr></table></figure>

<p>这里 -e 表示对转义字符进行替换。如果不使用 -e 选项，将会原样输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Value of a is 10\n</span><br></pre></td></tr></table></figure>

<p><font color = red>可以使用 echo 命令的 -E 选项禁止转义，默认也是不转义的；使用 -n 选项可以禁止插入换行符。</font></p>
<h4 id="输入输出-PRINTF"><a href="#输入输出-PRINTF" class="headerlink" title="输入输出-PRINTF"></a>输入输出-PRINTF</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-28-44%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<ul>
<li>printf命令不用加括号</li>
<li>format-string可以没有引号，但最好加上，单引号双引号相似。</li>
<li>参数多于格式控制符（％）时，format-string可以重用，可以将所有参数都转换。</li>
<li>arguments使用空格分隔，不用逗号。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">printf</span> <span class="string">"%d %s\n"</span> 1 <span class="string">"abc"</span></span></span><br><span class="line">1 abc</span><br></pre></td></tr></table></figure>



<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-29-20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p>在 Shell中，调用函数时可以向其传递参数。在函数体内部，通过 $n 的形式来获取参数的值，例如，$1 表示第一个参数，$2 表示第二个参数…</p>
<p>带参数的函数示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">funWithParam()&#123;</span><br><span class="line">    echo "The value of the first parameter is $1 !"</span><br><span class="line">    echo "The value of the second parameter is $2 !"</span><br><span class="line">    echo "The value of the tenth parameter is $10 !"</span><br><span class="line">    echo "The value of the tenth parameter is $&#123;10&#125; !"</span><br><span class="line">    echo "The value of the eleventh parameter is $&#123;11&#125; !"</span><br><span class="line">    echo "The amount of the parameters is $# !"  # 参数个数</span><br><span class="line">    echo "The string of the parameters is $* !"  # 传递给函数的所有参数</span><br><span class="line">&#125;</span><br><span class="line">funWithParam 1 2 3 4 5 6 7 8 9 34 73</span><br></pre></td></tr></table></figure>

<p>运行脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The value of the first parameter is 1 !</span><br><span class="line">The value of the second parameter is 2 !</span><br><span class="line">The value of the tenth parameter is 10 !</span><br><span class="line">The value of the tenth parameter is 34 !</span><br><span class="line">The value of the eleventh parameter is 73 !</span><br><span class="line">The amount of the parameters is 12 !</span><br><span class="line">The string of the parameters is 1 2 3 4 5 6 7 8 9 34 73 !"</span><br></pre></td></tr></table></figure>

<p>注意，$10 不能获取第十个参数，获取第十个参数需要 ${10}。当 n&gt;=10 时，需要使用 ${n} 来获取参数。</p>
<p>另外，还有几个特殊变量用来处理参数，前面已经提到：</p>
<table>
<thead>
<tr>
<th align="left">特殊变量</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$#</td>
<td align="left">传递给函数的参数个数。</td>
</tr>
<tr>
<td align="left">$*</td>
<td align="left">显示所有传递给函数的参数。</td>
</tr>
<tr>
<td align="left">$@</td>
<td align="left">与 $* 相同，但是略有区别，请查看 Shell 特殊变量。</td>
</tr>
<tr>
<td align="left">$?</td>
<td align="left">函数的返回值。</td>
</tr>
</tbody></table>
<h4 id="流程控制-IF"><a href="#流程控制-IF" class="headerlink" title="流程控制-IF"></a>流程控制-IF</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-30-34%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">    echo "a=b"</span><br><span class="line">else </span><br><span class="line">    echo "a!=b"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>if与[]有空格，内都有空格</p>
<ul>
<li>if … fi 语句；</li>
<li>if … else … fi 语句；</li>
<li>if … elif … else … fi 语句。</li>
</ul>
<p><strong>1)</strong> if … else 语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ expression ]</span><br><span class="line">then</span><br><span class="line">   Statement(s) to be executed if expression is true</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p><strong>2)</strong> if … else … fi 语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if [ expression ]</span><br><span class="line">then</span><br><span class="line">   Statement(s) to be executed if expression is true</span><br><span class="line">else</span><br><span class="line">   Statement(s) to be executed if expression is not true</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">   echo "a is equal to b"</span><br><span class="line">else</span><br><span class="line">   echo "a is not equal to b"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a is not equal to b</span><br></pre></td></tr></table></figure>

<p><strong>3)</strong> if … elif … fi 语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if [ expression 1 ]</span><br><span class="line">then</span><br><span class="line">   Statement(s) to be executed if expression 1 is true</span><br><span class="line">elif [ expression 2 ]</span><br><span class="line">then</span><br><span class="line">   Statement(s) to be executed if expression 2 is true</span><br><span class="line">elif [ expression 3 ]</span><br><span class="line">then</span><br><span class="line">   Statement(s) to be executed if expression 3 is true</span><br><span class="line">else</span><br><span class="line">   Statement(s) to be executed if no expression is true</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>if … else 语句也经常与 test 命令结合使用，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">num1=$[2*3]</span><br><span class="line">num2=$[1+5]</span><br><span class="line">if test $[num1] -eq $[num2]</span><br><span class="line">then</span><br><span class="line">    echo 'The two numbers are equal!'</span><br><span class="line">else</span><br><span class="line">    echo 'The two numbers are not equal!'</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The two numbers are equal!</span><br></pre></td></tr></table></figure>

<p>test 命令用于检查某个条件是否成立，与方括号([ ])类似。</p>
<h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><p>关系运算符只支持数字，不支持字符串，除非字符串的值是数字。</p>
<p>先来看一个关系运算符的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line">if [ $a -eq $b ]</span><br><span class="line">then</span><br><span class="line">   echo "$a -eq $b : a is equal to b"</span><br><span class="line">else</span><br><span class="line">   echo "$a -eq $b: a is not equal to b"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -ne $b ]</span><br><span class="line">then</span><br><span class="line">   echo "$a -ne $b: a is not equal to b"</span><br><span class="line">else</span><br><span class="line">   echo "$a -ne $b : a is equal to b"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -gt $b ]</span><br><span class="line">then</span><br><span class="line">   echo "$a -gt $b: a is greater than b"</span><br><span class="line">else</span><br><span class="line">   echo "$a -gt $b: a is not greater than b"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -lt $b ]</span><br><span class="line">then</span><br><span class="line">   echo "$a -lt $b: a is less than b"</span><br><span class="line">else</span><br><span class="line">   echo "$a -lt $b: a is not less than b"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -ge $b ]</span><br><span class="line">then</span><br><span class="line">   echo "$a -ge $b: a is greater or  equal to b"</span><br><span class="line">else</span><br><span class="line">   echo "$a -ge $b: a is not greater or equal to b"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -le $b ]</span><br><span class="line">then</span><br><span class="line">   echo "$a -le $b: a is less or  equal to b"</span><br><span class="line">else</span><br><span class="line">   echo "$a -le $b: a is not less or equal to b"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">10 -eq 20: a is not equal to b</span><br><span class="line">10 -ne 20: a is not equal to b</span><br><span class="line">10 -gt 20: a is not greater than b</span><br><span class="line">10 -lt 20: a is less than b</span><br><span class="line">10 -ge 20: a is not greater or equal to b</span><br><span class="line">10 -le 20: a is less or  equal to b</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
<th align="left">举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-eq</td>
<td align="left">检测两个数是否相等，相等返回 true。</td>
<td align="left">[ $a -eq $b ] 返回 true。</td>
</tr>
<tr>
<td align="left">-ne</td>
<td align="left">检测两个数是否相等，不相等返回 true。</td>
<td align="left">[ $a -ne $b ] 返回 true。</td>
</tr>
<tr>
<td align="left">-gt</td>
<td align="left">检测左边的数是否大于右边的，如果是，则返回 true。</td>
<td align="left">[ $a -gt $b ] 返回 false。</td>
</tr>
<tr>
<td align="left">-lt</td>
<td align="left">检测左边的数是否小于右边的，如果是，则返回 true。</td>
<td align="left">[ $a -lt $b ] 返回 true。</td>
</tr>
<tr>
<td align="left">-ge</td>
<td align="left">检测左边的数是否大等于右边的，如果是，则返回 true。</td>
<td align="left">[ $a -ge $b ] 返回 false。</td>
</tr>
<tr>
<td align="left">-le</td>
<td align="left">检测左边的数是否小于等于右边的，如果是，则返回 true。</td>
<td align="left">[ $a -le $b ] 返回 true。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
<th align="left">举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">!</td>
<td align="left">非运算，表达式为 true 则返回 false，否则返回 true。</td>
<td align="left">[ ! false ] 返回 true。</td>
</tr>
<tr>
<td align="left">-o</td>
<td align="left">或运算，有一个表达式为 true 则返回 true。</td>
<td align="left">[ $a -lt 20 -o $b -gt 100 ] 返回 true。</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">与运算，两个表达式都为 true 才返回 true。</td>
<td align="left">[ $a -lt 20 -a $b -gt 100 ] 返回 false。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
<th align="left">举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">=</td>
<td align="left">检测两个字符串是否相等，相等返回 true。</td>
<td align="left">[ $a = $b ] 返回 false。</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left">检测两个字符串是否相等，不相等返回 true。</td>
<td align="left">[ $a != $b ] 返回 true。</td>
</tr>
<tr>
<td align="left">-z</td>
<td align="left">检测字符串长度是否为0，为0返回 true。</td>
<td align="left">[ -z $a ] 返回 false。</td>
</tr>
<tr>
<td align="left">-n</td>
<td align="left">检测字符串长度是否为0，不为0返回 true。</td>
<td align="left">[ -z $a ] 返回 true。</td>
</tr>
<tr>
<td align="left">str</td>
<td align="left">检测字符串是否为空，不为空返回 true。</td>
<td align="left">[ $a ] 返回 true。</td>
</tr>
</tbody></table>
<h4 id="流程控制-WHILE"><a href="#流程控制-WHILE" class="headerlink" title="流程控制-WHILE"></a>流程控制-WHILE</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-31-26%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h4 id="流程控制-FOR"><a href="#流程控制-FOR" class="headerlink" title="流程控制-FOR"></a>流程控制-FOR</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-32-03%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for 变量 in 列表</span><br><span class="line">do</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<ul>
<li>例如</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for loop in 1 2 3 4 5</span><br><span class="line">do</span><br><span class="line">    echo &quot;The value is: $loop&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The value is: 1</span><br><span class="line">The value is: 2</span><br><span class="line">The value is: 3</span><br><span class="line">The value is: 4</span><br><span class="line">The value is: 5</span><br></pre></td></tr></table></figure>

<ul>
<li>顺序输出字符串中的字符：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for str in 'This is a string'</span><br><span class="line">do</span><br><span class="line">    echo $str</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a string</span><br></pre></td></tr></table></figure>

<ul>
<li>显示主目录下以 .bash 开头的文件：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">for FILE in $HOME/.bash*</span><br><span class="line">do</span><br><span class="line">   echo $FILE</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/root/.bash_history</span><br><span class="line">/root/.bash_logout</span><br><span class="line">/root/.bash_profile</span><br><span class="line">/root/.bashrc</span><br></pre></td></tr></table></figure>





<h4 id="流程控制-UNTIL"><a href="#流程控制-UNTIL" class="headerlink" title="流程控制-UNTIL"></a>流程控制-UNTIL</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-32-25%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h4 id="流程控制-CASE"><a href="#流程控制-CASE" class="headerlink" title="流程控制-CASE"></a>流程控制-CASE</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-33-34%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h4 id="Shell-字符串"><a href="#Shell-字符串" class="headerlink" title="Shell 字符串"></a>Shell 字符串</h4><p>字符串是 shell 编程中最常用最有用的数据类型（除了数字和字符串，也没啥其它类型好用了），字符串可以用单引号，也可以用双引号，也可以不用引号。单双引号的区别跟 PHP 类似。</p>
<ul>
<li>单引号</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str='this is a string'</span><br></pre></td></tr></table></figure>

<p>单引号字符串的限制： 单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的； 单引号字串中不能出现单引号（对单引号使用转义符后也不行）。</p>
<ul>
<li>双引号</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">your_name='qinjx'</span><br><span class="line">str="Hello, I know your are \"$your_name\"! \n"</span><br></pre></td></tr></table></figure>

<p>双引号的优点： 双引号里可以有变量 双引号里可以出现转义字符</p>
<ul>
<li>拼接字符串</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">your_name="qinjx"</span><br><span class="line">greeting="hello, "$your_name" !"</span><br><span class="line">greeting_1="hello, $&#123;your_name&#125; !"</span><br><span class="line"></span><br><span class="line">echo $greeting $greeting_1</span><br></pre></td></tr></table></figure>

<ul>
<li>获取字符串长度</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string="abcd"</span><br><span class="line">echo $&#123;#string&#125; #输出4</span><br></pre></td></tr></table></figure>

<ul>
<li>提取子字符串</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string="alibaba is a great company"</span><br><span class="line">echo $&#123;string:1:4&#125; #输出 liba</span><br></pre></td></tr></table></figure>

<ul>
<li>查找子字符串</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string="alibaba is a great company"</span><br><span class="line">echo `expr index "$string" is`</span><br></pre></td></tr></table></figure>



<p>####　数组</p>
<p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-34-13%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h4 id="数组操作"><a href="#数组操作" class="headerlink" title="数组操作"></a>数组操作</h4><p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-34-45%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p><img src="linux3.14%E7%AC%94%E8%AE%B0.assets/2020-03-12%2021-35-16%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<ul>
<li>读取数组</li>
</ul>
<p>读取数组元素值的一般格式是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;array_name[index]&#125;</span></span><br></pre></td></tr></table></figure>

<p>使用@或*可以获取数组中的所有元素，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;array_name[*]&#125;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;array_name[@]&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取数组的长度</li>
</ul>
<p>获取数组长度的方法与获取字符串长度的方法相同，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 取得数组元素的个数</span></span><br><span class="line">length=$&#123;#array_name[@]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">length=$&#123;#array_name[*]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 取得数组单个元素的长度</span></span><br><span class="line">lengthn=$&#123;#array_name[n]&#125;</span><br></pre></td></tr></table></figure>

<h1 id="命令系统"><a href="#命令系统" class="headerlink" title="命令系统"></a>命令系统</h1><h4 id="man手册使用"><a href="#man手册使用" class="headerlink" title="man手册使用"></a>man手册使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man ls</span><br><span class="line">man ssh</span><br></pre></td></tr></table></figure>

<p>在man中，常见的几个数字含义：</p>
<table>
<thead>
<tr>
<th>代号</th>
<th>代表的含义</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>１</td>
<td>用户在shell环境下可以操作的命令或可执行文件</td>
<td><code>man 1 ls</code></td>
</tr>
<tr>
<td>２</td>
<td>系统内核可以调用的函数和工具</td>
<td><code>man 2 reboot</code></td>
</tr>
<tr>
<td>３</td>
<td>一些常用的函数和函数库，大部分ｃ的函数库</td>
<td><code>man 3 readdir</code></td>
</tr>
<tr>
<td>４</td>
<td>设备文件的说明，通常实在<code>/dev</code>下的设备</td>
<td><code>man 4 null</code></td>
</tr>
<tr>
<td>５</td>
<td>配置文件或某些文件格式</td>
<td><code>man 5 interfaces</code></td>
</tr>
<tr>
<td>６</td>
<td>游戏</td>
<td><code>man 6 lol</code></td>
</tr>
<tr>
<td>７</td>
<td>惯例与协议等，例如<code>linux</code> 文件系统，网络协议等</td>
<td><code>man 7 tcp</code></td>
</tr>
<tr>
<td>８</td>
<td>系统管理员可用的命令</td>
<td><code>man 8 reboot</code></td>
</tr>
<tr>
<td>９</td>
<td>跟kernel有用的文件</td>
<td></td>
</tr>
</tbody></table>
<h4 id="shell通配符"><a href="#shell通配符" class="headerlink" title="shell通配符"></a>shell通配符</h4><ul>
<li><p>?</p>
<p>代表单个任意字符, 就是.cpp什么的前面是单个字符的</p>
<p>几个？代表几个字符的文件</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ ls</span><br><span class="line">8.cpp 19.cpp 20.cpp</span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ ls ?.cpp</span><br><span class="line">8.cpp</span><br></pre></td></tr></table></figure>

<ul>
<li><p>*</p>
<p>代表任意几个字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ ls</span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ ls *.cpp</span><br><span class="line">8.cpp  19.cpp 20.cpp</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>[list]</code>匹配list中的任意单一字符</p>
</li>
<li><p><code>[!list]</code>匹配除list中的任意单一字符</p>
</li>
<li><p><code>[c1-c2]</code>匹配<code>c1-c2</code>中的任意单一字符</p>
</li>
<li><p><code>{string,string2,...}</code>匹配<code>string</code>或其中一个字符串</p>
</li>
</ul>
<h4 id="Shell任务控制"><a href="#Shell任务控制" class="headerlink" title="Shell任务控制"></a>Shell任务控制</h4><p>1.<code>&amp;</code><br>在命令的后面加上<code>&amp;</code>表示后台执行的意思</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command &amp;</span><br></pre></td></tr></table></figure>
<p>2.<code>;</code><br>在命令之间用<code>;</code>项链，表示顺序执行的意思</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 ;command2</span><br></pre></td></tr></table></figure>
<p>3.<code>&amp;&amp;</code><br>命令之间以<code>&amp;&amp;</code>相连时，只有前一个命令成功执行则执行第二个命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 &amp;&amp; command2</span><br></pre></td></tr></table></figure>
<p>4.<code>||</code><br>命令之间以<code>||</code>相连时，如果前一个命令执行失败，则执行第二个命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 || command2</span><br></pre></td></tr></table></figure>
<p>5.``<br>命令中如果包含另一个命令，则用符号｀｀将它包起来，优先执行｀｀中的子命令，然后将其结果代入父命令继续执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 ` command2`</span><br></pre></td></tr></table></figure>
<p>6.<code>ctrl + z</code><br>暂时挂起<br>7.<code>bg</code><br>挂起的命令后台执行<br>8.<code>fg</code><br>后台执行的命令前台执行<br>9.<code>jobs</code><br>查看后台所有挂起的任务及编号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ ping baidu.com</span><br><span class="line">PING baidu.com (39.156.69.79) 56(84) bytes of data.</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=1 ttl=51 time=20.6 ms</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=2 ttl=51 time=22.4 ms</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=3 ttl=51 time=21.9 ms</span><br><span class="line">^Z</span><br><span class="line">[1]+  已停止               ping baidu.com</span><br><span class="line">fangsong@fangsong-FX503VD:~$ jobs</span><br><span class="line">[1]+  已停止               ping baidu.com</span><br><span class="line">fangsong@fangsong-FX503VD:~$ fg</span><br><span class="line">ping baidu.com</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=4 ttl=51 time=21.7 ms</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=5 ttl=51 time=21.9 ms</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=6 ttl=51 time=21.6 ms</span><br><span class="line">^C</span><br><span class="line">--- baidu.com ping statistics ---</span><br><span class="line">6 packets transmitted, 6 received, 0% packet loss, time 360ms</span><br><span class="line">rtt min/avg/max/mdev = 20.600/21.683/22.444/0.584 ms</span><br></pre></td></tr></table></figure>

<h4 id="管道，重定向"><a href="#管道，重定向" class="headerlink" title="管道，重定向"></a>管道，重定向</h4><p>管道｜</p>
<p>1.<code>&gt;</code><br>重定向符<br>2.<code>&gt;&gt;</code><br>作用与&gt;基本相同，不同的是&gt;&gt;将内容追加到文件的末尾，而&gt;内容覆盖原文件<br>3.<code>&lt;</code><br>与&gt;相反，是从文件到命令的重定向。他讲文件的内容输出到命令作为输入<br>4.<code>&lt;&lt;</code><br>？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Num=`cat /dev/urandom | head -n 10 | cksum | cut -d ' ' -f 1`</span><br></pre></td></tr></table></figure>

<p>此处就是管道，将前面的输出作为输入给后面</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ ./a.out &lt; in.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ cat &gt; a.log &lt;&lt;EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> fs</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ cat a.log</span><br><span class="line">fs</span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ cat &gt;&gt; a.log &lt;&lt;EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> fangsong</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ cat a.log</span><br><span class="line">fs</span><br><span class="line">fangsong</span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ cat &gt; a.log &lt;&lt;EOF #EOF结束标志</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 0</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF <span class="comment">#也可以换成其他的东西XXX</span></span></span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$ cat a.log</span><br><span class="line">0</span><br><span class="line">fangsong@fangsong-FX503VD:~/Mycode/2.f$</span><br></pre></td></tr></table></figure>

<h1 id="系统信息的获取"><a href="#系统信息的获取" class="headerlink" title="系统信息的获取"></a>系统信息的获取</h1><h4 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h4><blockquote>
<p>uptime 打印系统运行时长和平均负载</p>
<p>who显示当前登录系统用户信息</p>
<p>last显示用户最近登录用户信息</p>
<p>date显示或设置系统时间与日期</p>
<p>w当前登录用户列表及正在执行的任务</p>
<p>whoami打印当前有效的用户名称</p>
<p>uname打印当前系统信息</p>
<p>cal显示日历</p>
</blockquote>
<h4 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ uptime</span><br><span class="line"> 08:26:41 up 11 min,  1 user,  load average: 0.75, 1.41, 0.97</span><br></pre></td></tr></table></figure>

<h4 id="w"><a href="#w" class="headerlink" title="w"></a>w</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-h :不打印头信息</span><br><span class="line">-s :是hi用端输出格式</span><br><span class="line">-f :切换FROM项</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ w</span><br><span class="line"> 08:28:23 up 12 min,  1 user,  load average: 0.86, 1.27, 0.97</span><br><span class="line">USER     TTY      来自           LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">fangsong :0       :0               08:17   ?xdm?   1:46   0.01s /usr/lib/gdm3/g</span><br><span class="line">fangsong@fangsong-FX503VD:~$ w -h</span><br><span class="line">fangsong :0       :0               08:17   ?xdm?   1:49   0.01s /usr/lib/gdm3/g</span><br><span class="line">fangsong@fangsong-FX503VD:~$ w -s</span><br><span class="line"> 08:28:39 up 13 min,  1 user,  load average: 0.75, 1.23, 0.96</span><br><span class="line">USER     TTY      来自            空闲等待</span><br><span class="line">fangsong :0       :0               ?xdm?  /usr/lib/gdm3/gdm-x-session --run-s</span><br><span class="line">fangsong@fangsong-FX503VD:~$ w -f</span><br><span class="line"> 08:28:48 up 13 min,  1 user,  load average: 0.63, 1.19, 0.95</span><br><span class="line">USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">fangsong :0        08:17   ?xdm?   1:49   0.01s /usr/lib/gdm3/gdm-x-session --r</span><br><span class="line">fangsong@fangsong-FX503VD:~$</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>USER</th>
<th>TTY</th>
<th>FROM</th>
<th>LOGIN@</th>
<th>IDLE</th>
<th>JCPU</th>
<th>PCPU</th>
<th>WHAT</th>
</tr>
</thead>
<tbody><tr>
<td>登录用户名</td>
<td>登录后系统分配的端号</td>
<td>登录主机名</td>
<td>登录时间</td>
<td>空闲时间</td>
<td>和终端相连的所有进程所占用时间，当前正在执行的后台作业</td>
<td>当前进程占用时间</td>
<td>当前进程正在执行的的命令</td>
</tr>
</tbody></table>
<h4 id="who"><a href="#who" class="headerlink" title="who"></a>who</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ who -H #显示各栏标题新系列</span><br><span class="line">名称   线路       时间           备注</span><br><span class="line">fangsong :0           2020-03-15 08:17 (:0)</span><br><span class="line">fangsong@fangsong-FX503VD:~$ who -q#登录用户总人数</span><br><span class="line">fangsong</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户数=1</span></span><br><span class="line">fangsong@fangsong-FX503VD:~$ who -a</span><br><span class="line">           系统引导 2020-03-15 08:15</span><br><span class="line">           运行级别 5 2020-03-15 08:16</span><br><span class="line">fangsong ? :0           2020-03-15 08:17   ?          1763 (:0)</span><br><span class="line">fangsong@fangsong-FX503VD:~$ who -u#显示空闲时间</span><br><span class="line">fangsong :0           2020-03-15 08:17   ?          1763 (:0)</span><br></pre></td></tr></table></figure>

<h4 id="LAST"><a href="#LAST" class="headerlink" title="LAST"></a>LAST</h4><p>显示用户最近登录用户信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ last -n 5#指定输出记录数</span><br><span class="line">fangsong :0           :0               Sun Mar 15 08:17   still logged in</span><br><span class="line">reboot   system boot  5.0.0-38-generic Sun Mar 15 08:15   still running</span><br><span class="line">fangsong :0           :0               Sat Mar 14 10:08 - down   (13:37)</span><br><span class="line">reboot   system boot  5.0.0-38-generic Sat Mar 14 10:06 - 23:45  (13:38)</span><br><span class="line">fangsong :0           :0               Fri Mar 13 16:55 - 00:41  (07:45)</span><br><span class="line"></span><br><span class="line">wtmp begins Mon Nov 25 15:04:07 2019</span><br></pre></td></tr></table></figure>

<h4 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ uname -a#全部信息</span><br><span class="line">Linux fangsong-FX503VD 5.0.0-38-generic #41-Ubuntu SMP Tue Dec 3 00:27:35 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">fangsong@fangsong-FX503VD:~$ uname -m#电脑类型</span><br><span class="line">x86_64</span><br><span class="line">fangsong@fangsong-FX503VD:~$ uname -n#网络上主机的名称</span><br><span class="line">fangsong-FX503VD</span><br><span class="line">fangsong@fangsong-FX503VD:~$ uname -v#os版本</span><br><span class="line"><span class="meta">#</span><span class="bash">41-Ubuntu SMP Tue Dec 3 00:27:35 UTC 2019</span></span><br><span class="line">fangsong@fangsong-FX503VD:~$ uname -p#处理器类型</span><br><span class="line">x86_64</span><br><span class="line">fangsong@fangsong-FX503VD:~$ uname -i#硬件</span><br><span class="line">x86_64</span><br><span class="line">fangsong@fangsong-FX503VD:~$ uname -o#操作系统名称</span><br><span class="line">GNU/Linux</span><br></pre></td></tr></table></figure>

<h4 id="date"><a href="#date" class="headerlink" title="date"></a>date</h4><p>ntp协议：标准的时间</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ date</span><br><span class="line">2020年 03月 15日 星期日 08:43:00 CST</span><br><span class="line">fangsong@fangsong-FX503VD:~$ date +%s</span><br><span class="line">1584232994</span><br><span class="line">fangsong@fangsong-FX503VD:~$ date +%S</span><br><span class="line">22</span><br><span class="line">fangsong@fangsong-FX503VD:~$ date +%T</span><br><span class="line">08:43:31</span><br><span class="line">fangsong@fangsong-FX503VD:~$ date +%H+%M+%S</span><br><span class="line">08+43+55</span><br></pre></td></tr></table></figure>

<h1 id="基本系统"><a href="#基本系统" class="headerlink" title="基本系统"></a>基本系统</h1><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p><img src="https://github.com/fangsong0517/Figure-bed/blob/master/2020-03-15%2009-33-20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png?raw=true" alt="2020-03-15 09-33-20屏幕截图.png"><br><img src="https://github.com/fangsong0517/Figure-bed/blob/master/2020-03-15%2009-43-10%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png?raw=true" alt="2020-03-15 09-43-10屏幕截图.png"><br><img src="https://github.com/fangsong0517/Figure-bed/blob/master/2020-03-15%2009-43-36%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png?raw=true" alt="2020-03-15 09-43-36屏幕截图.png"></p>
<ul>
<li><p><strong>/bin</strong>：<br>bin是Binary的缩写, 这个目录存放着最经常使用的命令。</p>
</li>
<li><p><strong>/boot：</strong><br>这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。</p>
</li>
<li><p><strong>/dev ：</strong><br>dev是Device(设备)的缩写, 该目录下存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。</p>
</li>
<li><p><strong>/etc：</strong><br>这个目录用来存放所有的系统管理所需要的配置文件和子目录。</p>
</li>
<li><p><strong>/home</strong>：<br>用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。</p>
</li>
<li><p><strong>/lib</strong>：<br>这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。</p>
</li>
<li><p><strong>/lost+found</strong>：<br>这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</p>
</li>
<li><p><strong>/media</strong>：<br>linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。</p>
</li>
<li><p><strong>/mnt</strong>：<br>系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</p>
</li>
<li><p><strong>/opt</strong>：<br> 这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</p>
</li>
<li><p><strong>/proc</strong>：<br>这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。<br>这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：</p>
</li>
<li><p><strong>/root</strong>：<br>该目录为系统管理员，也称作超级权限者的用户主目录。</p>
</li>
<li><p><strong>/sbin</strong>：<br>s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。</p>
</li>
<li><p><strong>/selinux</strong>：<br> 这个目录是Redhat/CentOS所特有的目录，Selinux是一个安全机制，类似于windows的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。</p>
</li>
<li><p><strong>/srv</strong>：<br> 该目录存放一些服务启动之后需要提取的数据。</p>
</li>
<li><p><strong>/sys</strong>：</p>
<p> 这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs 。</p>
<p>sysfs文件系统集成了下面3种文件系统的信息：针对进程信息的proc文件系统、针对设备的devfs文件系统以及针对伪终端的devpts文件系统。该文件系统是内核设备树的一个直观反映。</p>
<p>当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建</p>
</li>
<li><p><strong>/tmp</strong>：<br>这个目录是用来存放一些临时文件的。</p>
</li>
<li><p><strong>/usr</strong>：<br>这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</p>
</li>
<li><p><strong>/usr/bin：</strong><br>系统用户使用的应用程序。</p>
</li>
<li><p><strong>/usr/sbin：</strong><br>超级用户使用的比较高级的管理程序和系统守护程序。</p>
</li>
<li><p><strong>/usr/src：</strong><br>内核源代码默认的放置目录。</p>
</li>
<li><p><strong>/var</strong>：<br>这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</p>
</li>
<li><p><strong>/run</strong>：<br>是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。</p>
</li>
</ul>
<p><strong>/etc</strong>： 上边也提到了，这个是系统中的配置文件，如果你更改了该目录下的某个文件可能会导致系统不能启动。</p>
<p><strong>/bin, /sbin, /usr/bin, /usr/sbin</strong>: 这是系统预设的执行文件的放置目录，比如 ls 就是在/bin/ls 目录下的。</p>
<p>值得提出的是，/bin, /usr/bin 是给系统用户使用的指令（除root外的通用户），而/sbin, /usr/sbin 则是给root使用的指令。</p>
<p><strong>/var</strong>： 这是一个非常重要的目录，系统上跑了很多程序，那么每个程序都会有相应的日志产生，而这些日志就被记录到这个目录下，具体在/var/log 目录下，另外mail的预设放置也是在这里。</p>
<h1 id="文件与目录操作"><a href="#文件与目录操作" class="headerlink" title="文件与目录操作"></a>文件与目录操作</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www /]# ls -l</span><br><span class="line">total 64</span><br><span class="line">dr-xr-xr-x   2 root root 4096 Dec 14  2012 bin</span><br><span class="line">dr-xr-xr-x   4 root root 4096 Apr 19  2012 boot</span><br></pre></td></tr></table></figure>

<p>实例中，bin文件的第一个属性用”d”表示。”d”在Linux中代表该文件是一个目录文件。</p>
<p>在Linux中第一个字符代表这个文件是目录、文件或链接文件等等。</p>
<ul>
<li>当为[ <strong>d</strong> ]则是目录</li>
<li>当为[ <strong>-</strong> ]则是文件；</li>
<li>若是[ <strong>l</strong> ]则表示为链接文档(link file)；</li>
<li>若是[ <strong>b</strong> ]则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；</li>
<li>若是[ <strong>c</strong> ]则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。</li>
</ul>
<p><img src="https://www.runoob.com/wp-content/uploads/2014/06/363003_1227493859FdXT.png" alt="363003_1227493859FdXT"></p>
<h4 id="chgrp：更改文件属组"><a href="#chgrp：更改文件属组" class="headerlink" title="chgrp：更改文件属组"></a>chgrp：更改文件属组</h4><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp [-R] 属组名 文件名</span><br></pre></td></tr></table></figure>

<p>参数选项</p>
<ul>
<li>-R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。</li>
</ul>
<h4 id="chown：更改文件属主，也可以同时更改文件属组"><a href="#chown：更改文件属主，也可以同时更改文件属组" class="headerlink" title="chown：更改文件属主，也可以同时更改文件属组"></a>chown：更改文件属主，也可以同时更改文件属组</h4><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown [–R] 属主名 文件名</span><br><span class="line">chown [-R] 属主名：属组名 文件名</span><br></pre></td></tr></table></figure>

<p>进入 /root 目录（~）将install.log的拥有者改为bin这个账号：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~] cd ~</span><br><span class="line">[root@www ~]# chown bin install.log</span><br><span class="line">[root@www ~]# ls -l</span><br><span class="line">-rw-r--r--  1 bin  users 68495 Jun 25 08:53 install.log</span><br></pre></td></tr></table></figure>

<p>将install.log的拥有者与群组改回为root：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# chown root:root install.log</span><br><span class="line">[root@www ~]# ls -l</span><br><span class="line">-rw-r--r--  1 root root 68495 Jun 25 08:53 install.log</span><br></pre></td></tr></table></figure>

<h4 id="chmod：更改文件9个属性"><a href="#chmod：更改文件9个属性" class="headerlink" title="chmod：更改文件9个属性"></a>chmod：更改文件9个属性</h4><p>Linux文件属性有两种设置方法，一种是数字，一种是符号。</p>
<p>Linux文件的基本权限就有九个，分别是owner/group/others三种身份各有自己的read/write/execute权限。</p>
<p>先复习一下刚刚上面提到的数据：文件的权限字符为：『-rwxrwxrwx』， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：</p>
<ul>
<li>r:4</li>
<li>w:2</li>
<li>x:1</li>
</ul>
<p>每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： [-rwxrwx—] 分数则是：</p>
<ul>
<li>owner = rwx = 4+2+1 = 7</li>
<li>group = rwx = 4+2+1 = 7</li>
<li>others= — = 0+0+0 = 0</li>
</ul>
<p>所以等一下我们设定权限的变更时，该文件的权限数字就是770啦！变更权限的指令chmod的语法是这样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [-R] xyz 文件或目录</span><br></pre></td></tr></table></figure>

<p>选项与参数：</p>
<ul>
<li>xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。</li>
<li>-R : 进行递归(recursive)的持续变更，亦即连同次目录下的所有文件都会变更</li>
</ul>
<p>举例来说，如果要将.bashrc这个文件所有的权限都设定启用，那么命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# ls -al .bashrc</span><br><span class="line">-rw-r--r--  1 root root 395 Jul  4 11:45 .bashrc</span><br><span class="line">[root@www ~]# chmod 777 .bashrc</span><br><span class="line">[root@www ~]# ls -al .bashrc</span><br><span class="line">-rwxrwxrwx  1 root root 395 Jul  4 11:45 .bashrc</span><br></pre></td></tr></table></figure>

<p>那如果要将权限变成 <em>-rwxr-xr–</em> 呢？那么权限的分数就成为 [4+2+1][4+0+1][4+0+0]=754。</p>
<h4 id="符号类型改变文件权限"><a href="#符号类型改变文件权限" class="headerlink" title="符号类型改变文件权限"></a>符号类型改变文件权限</h4><p>还有一个改变权限的方法，从之前的介绍中我们可以发现，基本上就九个权限分别是：</p>
<ul>
<li>(1)user</li>
<li>(2)group</li>
<li>(3)others</li>
</ul>
<p>那么我们就可以使用 <strong>u, g, o</strong> 来代表三种身份的权限！</p>
<p>此外， <strong>a</strong> 则代表 <strong>all</strong>，即全部的身份。读写的权限可以写成 <strong>r, w, x</strong>，也就是可以使用下表的方式来看：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>u</td>
<td>+(加入)</td>
<td>r</td>
<td></td>
</tr>
<tr>
<td>chmod</td>
<td>g</td>
<td>-(除去)</td>
<td>w</td>
<td>文件或目录</td>
</tr>
<tr>
<td></td>
<td>o</td>
<td>=(设定)</td>
<td>x</td>
<td></td>
</tr>
<tr>
<td></td>
<td>a</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>如果我们需要将文件权限设置为 <strong>-rwxr-xr–</strong> ，可以使用 <strong>chmod u=rwx,g=rx,o=r 文件名</strong> 来设定:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  touch test1    // 创建 test1 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -al test1    // 查看 test1 默认权限</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod u=rwx,g=rx,o=r  test1    // 修改 test1 权限</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -al test1</span></span><br><span class="line">-rwxr-xr-- 1 root root 0 Nov 15 10:32 test1</span><br></pre></td></tr></table></figure>

<p>而如果是要将权限去掉而不改变其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  chmod  a-x test1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -al test1</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>绝对路径：</strong><br>路径的写法，由根目录 / 写起，例如： /usr/share/doc 这个目录。</li>
<li><strong>相对路径：</strong><br>路径的写法，不是由 / 写起，例如由 /usr/share/doc 要到 /usr/share/man 底下时，可以写成： cd ../man 这就是相对路径的写法啦！</li>
</ul>
<h4 id="CD切换工作目录"><a href="#CD切换工作目录" class="headerlink" title="CD切换工作目录"></a>CD切换工作目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /etc #直接切换到/etc目录</span><br><span class="line">cd .. #切换到上层目录</span><br><span class="line">cd . #切换到当前目录</span><br><span class="line">cd #回到自己的家目录</span><br><span class="line">cd ~#回到自己的家目录</span><br><span class="line">cd -#回到上次的工作目录</span><br></pre></td></tr></table></figure>

<h4 id="PWD"><a href="#PWD" class="headerlink" title="PWD"></a>PWD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">L 显示逻辑工作目录</span><br><span class="line">P 显示物理工作目录</span><br></pre></td></tr></table></figure>

<p>pwd 是 <strong>Print Working Directory</strong> 的缩写，也就是显示目前所在目录的命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# pwd [-P]</span><br></pre></td></tr></table></figure>

<p>选项与参数：</p>
<ul>
<li><strong>-P</strong> ：显示出确实的路径，而非使用连结 (link) 路径。</li>
</ul>
<p>实例：单纯显示出目前的工作目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# pwd</span><br><span class="line">/root   &lt;== 显示出目录啦～</span><br></pre></td></tr></table></figure>

<p>实例显示出实际的工作目录，而非连结档本身的目录名而已。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# cd /var/mail   &lt;==注意，/var/mail是一个连结档</span><br><span class="line">[root@www mail]# pwd</span><br><span class="line">/var/mail         &lt;==列出目前的工作目录</span><br><span class="line">[root@www mail]# pwd -P</span><br><span class="line">/var/spool/mail   &lt;==怎么回事？有没有加 -P 差很多～</span><br><span class="line">[root@www mail]# ls -ld /var/mail</span><br><span class="line">lrwxrwxrwx 1 root root 10 Sep  4 17:54 /var/mail -&gt; spool/mail</span><br><span class="line"><span class="meta">#</span><span class="bash"> 看到这里应该知道为啥了吧？因为 /var/mail 是连结档，连结到 /var/spool/mail </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所以，加上 <span class="built_in">pwd</span> -P 的选项后，会不以连结档的数据显示，而是显示正确的完整路径啊！</span></span><br></pre></td></tr></table></figure>

<h4 id="MkDIR创建目录"><a href="#MkDIR创建目录" class="headerlink" title="MkDIR创建目录"></a>MkDIR创建目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-p 自动创建父目录：帮助你直接将所需要的目录(包含上一级目录)递归创建起来！</span><br><span class="line">-m 设置权限：配置文件的权限喔！直接配置，不需要看默认权限 (umask) 的脸色～</span><br></pre></td></tr></table></figure>

<p>实例：请到/tmp底下尝试创建数个新目录看看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# cd /tmp</span><br><span class="line">[root@www tmp]# mkdir test    &lt;==创建一名为 test 的新目录</span><br><span class="line">[root@www tmp]# mkdir test1/test2/test3/test4</span><br><span class="line">mkdir: cannot create directory `test1/test2/test3/test4': </span><br><span class="line">No such file or directory       &lt;== 没办法直接创建此目录啊！</span><br><span class="line">[root@www tmp]# mkdir -p test1/test2/test3/test4</span><br></pre></td></tr></table></figure>

<p>加了这个 -p 的选项，可以自行帮你创建多层目录！</p>
<p>实例：创建权限为 <strong>rwx–x–x</strong> 的目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@www tmp]# mkdir -m 711 test2</span><br><span class="line">[root@www tmp]# ls -l</span><br><span class="line">drwxr-xr-x  3 root  root 4096 Jul 18 12:50 test</span><br><span class="line">drwxr-xr-x  3 root  root 4096 Jul 18 12:53 test1</span><br><span class="line">drwx--x--x  2 root  root 4096 Jul 18 12:54 test2</span><br></pre></td></tr></table></figure>

<p>上面的权限部分，如果没有加上 -m 来强制配置属性，系统会使用默认属性。</p>
<p>如果我们使用 -m ，如上例我们给予 -m 711 来给予新的目录 drwx–x–x 的权限。</p>
<h4 id="RMDIR删除目录"><a href="#RMDIR删除目录" class="headerlink" title="RMDIR删除目录"></a>RMDIR删除目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p删除祖先</span><br><span class="line">-p ：连同上一级『空的』目录也一起删除</span><br></pre></td></tr></table></figure>

<p>删除 runoob 目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www tmp]# rmdir runoob/</span><br></pre></td></tr></table></figure>

<p>将 mkdir 实例中创建的目录(/tmp 底下)删除掉！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@www tmp]# rmdir -p test1/test2/test3/test4</span><br><span class="line">[root@www tmp]# ls -l        &lt;==您看看，底下的输出中test与test1不见了！</span><br></pre></td></tr></table></figure>

<p>利用 -p 这个选项，立刻就可以将 test1/test2/test3/test4 一次删除。</p>
<p>不过要注意的是，这个 rmdir 仅能删除空的目录，你可以使用 rm 命令来删除非空目录。</p>
<h4 id="CP"><a href="#CP" class="headerlink" title="CP"></a>CP</h4><p>cp 即拷贝文件和目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-i :若文件存在，询问用户</span><br><span class="line">-r :递归赋值</span><br><span class="line">-a ：pdr的集合</span><br><span class="line">-p: 连同文件属性一起复制</span><br><span class="line">-d:若源文件为链接文件的属性，则赋值链接文件的属性</span><br><span class="line">-s:拷贝为软连接</span><br><span class="line">-l:拷贝为硬链接</span><br><span class="line">-u：原文件比目的文件新才拷贝</span><br></pre></td></tr></table></figure>

<p>用 root 身份，将 root 目录下的 .bashrc 复制到 /tmp 下，并命名为 bashrc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# cp ~/.bashrc /tmp/bashrc</span><br><span class="line">[root@www ~]# cp -i ~/.bashrc /tmp/bashrc</span><br><span class="line">cp: overwrite `/tmp/bashrc'? n  &lt;==n不覆盖，y为覆盖</span><br></pre></td></tr></table></figure>

<h4 id="RM"><a href="#RM" class="headerlink" title="RM"></a>RM</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm [-fir] 文件或目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-i :互动模式互动模式，在删除前会询问使用者是否动作</span><br><span class="line">-r :递归删除递归删除啊！最常用在目录的删除了！这是非常危险的选项！！！</span><br><span class="line">-f：force忽略不存在的文件，不会出现警告信息；</span><br></pre></td></tr></table></figure>





<h4 id="MV"><a href="#MV" class="headerlink" title="MV"></a>MV</h4><p>移动文件与目录，或修改名称</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# mv [-fiu] source destination</span><br><span class="line">[root@www ~]# mv [options] source1 source2 source3 .... directory</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-i :互动模式若目标文件 (destination) 已经存在时，就会询问是否覆盖！</span><br><span class="line">-f：force强制的意思，如果目标文件已经存在，不会询问而直接覆盖；</span><br><span class="line">-u:源文件跟新才会移动若目标文件已经存在，且 source 比较新，才会升级 (update)</span><br></pre></td></tr></table></figure>

<p>复制一文件，创建一目录，将文件移动到目录中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# cd /tmp</span><br><span class="line">[root@www tmp]# cp ~/.bashrc bashrc</span><br><span class="line">[root@www tmp]# mkdir mvtest</span><br><span class="line">[root@www tmp]# mv bashrc mvtest</span><br></pre></td></tr></table></figure>

<p>将某个文件移动到某个目录去，就是这样做！</p>
<p>将刚刚的目录名称更名为 mvtest2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www tmp]# mv mvtest mvtest2</span><br></pre></td></tr></table></figure>

<h3 id="Linux-文件内容查看"><a href="#Linux-文件内容查看" class="headerlink" title="Linux 文件内容查看"></a>Linux 文件内容查看</h3><p>Linux系统中使用以下命令来查看文件的内容：</p>
<ul>
<li>cat 由第一行开始显示文件内容</li>
<li>tac 从最后一行开始显示，可以看出 tac 是 cat 的倒著写！</li>
<li>nl  显示的时候，顺道输出行号！</li>
<li>more 一页一页的显示文件内容</li>
<li>less 与 more 类似，但是比 more 更好的是，他可以往前翻页！</li>
<li>head 只看头几行</li>
<li>tail 只看尾巴几行</li>
</ul>
<h4 id="CAT"><a href="#CAT" class="headerlink" title="CAT"></a>CAT</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-A:相当于-VET</span><br><span class="line">-v:列出看不到的字符</span><br><span class="line">-E:显示断行符为￥</span><br><span class="line">-T：显示TAB为^I</span><br><span class="line">-b:列出行号列出行号，仅针对非空白行做行号显示，空白行不标行号！</span><br><span class="line">-n:列出行号，空行也编号</span><br></pre></td></tr></table></figure>

<h4 id="TAC"><a href="#TAC" class="headerlink" title="TAC"></a>TAC</h4><p>tac与cat命令刚好相反，文件内容从最后一行开始显示，可以看出 tac 是 cat 的倒着写！如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# tac /etc/issue</span><br><span class="line"></span><br><span class="line">Kernel \r on an \m</span><br><span class="line">CentOS release 6.4 (Final)</span><br></pre></td></tr></table></figure>

<h4 id="NL输出行号显示文件"><a href="#NL输出行号显示文件" class="headerlink" title="NL输出行号显示文件"></a>NL输出行号显示文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl [-bnw] 文件</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-b a:相当于cat -a表示不论是否为空行，也同样列出行号</span><br><span class="line">-b t:相当于cat -b如果有空行，空的那一行不要列出行号</span><br><span class="line">-n ln:行号在屏幕的最左边显示</span><br><span class="line">-n rn:行号在自己字段的最右边显示且不加 0 </span><br><span class="line">-n rz:行号在自己字段的最右边显示，前面自动补0</span><br><span class="line">-w &lt;num&gt;：行号所占位数</span><br></pre></td></tr></table></figure>

<p>实例一：用 nl 列出 /etc/issue 的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# nl /etc/issue</span><br><span class="line">     1  CentOS release 6.4 (Final)</span><br><span class="line">     2  Kernel \r on an \m</span><br></pre></td></tr></table></figure>

<h4 id="HEAD查看头几行"><a href="#HEAD查看头几行" class="headerlink" title="HEAD查看头几行"></a>HEAD查看头几行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">head [-n num] &lt;file&gt;</span><br><span class="line">-n num:显示前几行</span><br><span class="line">-n -num:除后几行外，其他都显示</span><br></pre></td></tr></table></figure>

<p>取出文件前面几行</p>
<p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head [-n number] 文件</span><br></pre></td></tr></table></figure>

<p>选项与参数：</p>
<ul>
<li>-n ：后面接数字，代表显示几行的意思</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# head /etc/man.config</span><br></pre></td></tr></table></figure>

<p>默认的情况中，显示前面 10 行！若要显示前 20 行，就得要这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# head -n 20 /etc/man.config</span><br></pre></td></tr></table></figure>

<h4 id="TAIL查看末尾几行"><a href="#TAIL查看末尾几行" class="headerlink" title="TAIL查看末尾几行"></a>TAIL查看末尾几行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail [-n num] &lt;file&gt;</span><br><span class="line">-n num:显示文件后num行</span><br><span class="line">-n +num:除前几行外，其他都显示</span><br></pre></td></tr></table></figure>

<p>选项与参数：</p>
<ul>
<li>-n ：后面接数字，代表显示几行的意思</li>
<li>-f ：表示持续侦测后面所接的档名，要等到按下[ctrl]-c才会结束tail的侦测</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# tail /etc/man.config</span><br><span class="line"># 默认的情况中，显示最后的十行！若要显示最后的 20 行，就得要这样：</span><br><span class="line">[root@www ~]# tail -n 20 /etc/man.config</span><br></pre></td></tr></table></figure>

<h4 id="文件时间及隐藏属性"><a href="#文件时间及隐藏属性" class="headerlink" title="文件时间及隐藏属性"></a>文件时间及隐藏属性</h4><blockquote>
<p>文件的三个时间</p>
<blockquote>
<p>mtime :内容数据改动时才更新这个时间</p>
<p>ctime:文件的权限，文件改动更新这个时间</p>
<p>atime:文件的内容被取用access时，更新这个时间</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l --time=ctime /etc/hostname</span><br></pre></td></tr></table></figure>

<p>ls -l #是行列表形式<br>–time=ctime# 显示这个时间为ctime, –后面通常加原型<br>每个文件都有这三种属性</p>
<h4 id="修改文件时间与新建文件"><a href="#修改文件时间与新建文件" class="headerlink" title="修改文件时间与新建文件"></a>修改文件时间与新建文件</h4><blockquote>
<p>touch [-acdmt] <file></p>
<blockquote>
<p>-a:仅修改访问时间<br>-c:金修改文件的时间，若文件不存在，不新建<br>-d:修改文件日期<br>-m:金修改mtime<br>-t:修改文件时间[yymmddhhmm]</p>
</blockquote>
</blockquote>
<h4 id="文件隐藏属性"><a href="#文件隐藏属性" class="headerlink" title="文件隐藏属性"></a>文件隐藏属性</h4><blockquote>
<p>chattr [+-=] [ASacdistu] <file_or_dir></p>
<p>A:不修改atime<br>S:同步写入 //不缓存直接写到磁盘上，例如银行<br>a:只能增加数据　//通常用在日志上<br>c:自动压缩，解压<br>d:不会被dump程序备份<br>i:不能删除修改建立连接 //写死了<br>s:文件删除时，直接从磁盘删除<br>u:文件删除时，文件内容存在磁盘中</p>
</blockquote>
<h4 id="文件的特殊权限"><a href="#文件的特殊权限" class="headerlink" title="文件的特殊权限"></a>文件的特殊权限</h4><blockquote>
<p>set_uid    s占位符       作用二进制程序文件，费脚本　　　　　用户在执行该程序时获取程序所有者权限<br>set_git　s占位符        目录和二进制文件　　　　　　　　　　用户在该目录下，有效组变为目录所属组<br>sticky Bit　t占位符　　目录　　　　　　　　　再改目录下，用户只能删除自己穿就爱你的内容</p>
</blockquote>
<h1 id="文件与目录操作、实现ls命令"><a href="#文件与目录操作、实现ls命令" class="headerlink" title="文件与目录操作、实现ls命令"></a>文件与目录操作、实现ls命令</h1><h4 id="如何在Linux中查找文件"><a href="#如何在Linux中查找文件" class="headerlink" title="如何在Linux中查找文件"></a>如何在Linux中查找文件</h4><table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>which</td>
<td>寻找可执行文件</td>
<td>whereis</td>
<td>寻找特定文件</td>
</tr>
<tr>
<td>locate</td>
<td>搜索文件(可部分查找)</td>
<td>find</td>
<td>多样化高级查找</td>
</tr>
</tbody></table>
<ul>
<li>which寻找可执行文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ ls -a `which ping`</span><br><span class="line">/usr/bin/ping</span><br></pre></td></tr></table></figure>

<ul>
<li><p>whereis寻找特定文件</p>
<p>-b:查找二进制文件</p>
<p>-m:查找man手册</p>
<p>-s:查找source源文件</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ whereis ping</span><br><span class="line">ping: /usr/bin/ping /usr/share/man/man8/ping.8.gz</span><br></pre></td></tr></table></figure>

<ul>
<li><p>locate模糊定义</p>
<p>-i:忽略大小写</p>
<p>-r:后面可接正则表达式</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ locate prime.cpp</span><br><span class="line">/home/fangsong/Mycode/1.c语言/4/1.prime.cpp</span><br><span class="line">/home/fangsong/Mycode/2.EP/prime.cpp</span><br><span class="line">/home/fangsong/Mycode/2.f/prime.cpp</span><br></pre></td></tr></table></figure>

<ul>
<li><p>find高级查找</p>
<p>find [path] [option] [action]</p>
<p>与时间相关的参数：-atime -ctime -mtime</p>
<p>-mtime n : ｎ天前的”一天之内”修改的文件 amin</p>
<p>-mtime +n: n天之前，不包含ｎ，修改过的文件</p>
<p>-mtime -n:ｎ天之内，包含ｎ，修改过的文件</p>
<p>-newer file:比file 还要新的文件</p>
<p>与用户或者用户组相关的参数：</p>
<p>-uid n:用户UID为ｎ</p>
<p>-gid n:群组GID为ｎ</p>
<p>-user name:用户名为name</p>
<p>-group name:群组名为name</p>
<p>nouser:文件所有者不存在</p>
<p>nogroup:文件所有组不存在</p>
<p>与文件权限名称有关的参数：</p>
<p>-name filename: 文件名为filrname</p>
<p>-size [+-] SIZE:查找比SIZE大或小的</p>
<p>-type TYPE：f b c d l s p</p>
<p>-perm mode : mode 刚好等于的文件</p>
<p>-perm -mode: 全部包含mode的文件</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find -exec ls -l &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">find . -name "*.cpp" -mtime -1 -exec wc -l &#123;&#125; \ #一天前.cpp文件的统计行数</span><br></pre></td></tr></table></figure>

<p>查找家目录下所有.cpp,.c,.sh,.h的行数总和</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ~ -name "*.cpp" -o -name "*.c" -o -name "*.h" -o -name "*.sh" | xargs wc -l</span><br></pre></td></tr></table></figure>





<h4 id="实现ls需要用到的函数"><a href="#实现ls需要用到的函数" class="headerlink" title="实现ls需要用到的函数"></a>实现ls需要用到的函数</h4><h5 id="opendir"><a href="#opendir" class="headerlink" title="opendir()"></a>opendir()</h5><p><strong>头文件</strong><br>　　#include&lt;sys/types.h&gt;<br>　　#include&lt;dirent.h&gt;<br><strong>函数原型</strong><br>　　DIR* opendir (const char * path ); （获取path子目录下的所由文件和目录的列表，如果path是个文件则返回值为NULL）<br><strong>功能</strong><br>　　<font color= red>打开一个目录，在失败的时候返回一个空的指针。</font><br><strong>返回值(DIR)</strong><br>       DIR 结构体的原型为：struct_dirstream<br>       在Linux系统中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">dirstream</span> <span class="title">DIR</span>;</span></span><br><span class="line"></span><br><span class="line">      <span class="class"><span class="keyword">struct</span> __<span class="title">dirstream</span></span></span><br><span class="line"><span class="class">      &#123;</span></span><br><span class="line">        <span class="keyword">void</span> *__fd; <span class="comment">/* `struct hurd_fd' pointer for descriptor.   */</span></span><br><span class="line">        <span class="keyword">char</span> *__data; <span class="comment">/* Directory block.   */</span></span><br><span class="line">        <span class="keyword">int</span> __entry_data; <span class="comment">/* Entry number `__data' corresponds to.   */</span></span><br><span class="line">        <span class="keyword">char</span> *__ptr; <span class="comment">/* Current pointer into the block.   */</span></span><br><span class="line">        <span class="keyword">int</span> __entry_ptr; <span class="comment">/* Entry number `__ptr' corresponds to.   */</span></span><br><span class="line">        <span class="keyword">size_t</span> __allocation; <span class="comment">/* Space allocated for the block.   */</span></span><br><span class="line">        <span class="keyword">size_t</span> __size; <span class="comment">/* Total valid data in the block.   */</span></span><br><span class="line">        __libc_lock_define (, __lock) <span class="comment">/* Mutex lock for this structure.   */</span></span><br><span class="line">       &#125;;</span><br></pre></td></tr></table></figure>

<h5 id="readdir"><a href="#readdir" class="headerlink" title="readdir()"></a>readdir()</h5><p><strong>头文件</strong><br>#include&lt;dirent.h&gt;<br><strong>函数原型</strong><br>struct dirent* readdir(DIR* dir_handle); （个人理解循环读取dir_handle,目录和文件都读）<br><strong>功能</strong><br><font color = red>读取opendir 返回值的那个列表</font><br><strong>返回值</strong><br>返回dirent结构体指针，dirent结构体成员如下，（文件和目录都行）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dirent</span></span></span><br><span class="line"><span class="class">　　&#123;</span></span><br><span class="line">　　<span class="keyword">long</span> d_ino; <span class="comment">/* inode number 索引节点号 */</span></span><br><span class="line">　　<span class="keyword">off_t</span> d_off; <span class="comment">/* offset to this dirent 在目录文件中的偏移 */</span></span><br><span class="line">　　<span class="keyword">unsigned</span> <span class="keyword">short</span> d_reclen; <span class="comment">/* length of this d_name 文件名长 */</span></span><br><span class="line">　　<span class="keyword">unsigned</span> <span class="keyword">char</span> d_type; <span class="comment">/* the type of d_name 文件类型 */</span></span><br><span class="line">　　<span class="keyword">char</span> d_name [NAME_MAX+<span class="number">1</span>]; <span class="comment">/* file name (null-terminated) 文件名，最长255字符 */</span></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>

<h5 id="perror"><a href="#perror" class="headerlink" title="perror()"></a>perror()</h5><p><font color = red>将上一个函数发生错误的原因输出</font></p>
<h5 id="closedir"><a href="#closedir" class="headerlink" title="closedir()"></a>closedir()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">closedir</span><span class="params">(DIR *dir)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​     closedir()关闭参数dir所指的目录流。关闭成功则返回0，失败返回-1，错误原因存于errno 中。EBADF 参数dir为无效的目录流。注意：目录文件作为一种文件，再打开必须关闭，否则会由于文件的进程打开文件过多而不能打开新的文件。因此opendir函数和closedir函数同样是配对出现的</p>
<h5 id="stat函数"><a href="#stat函数" class="headerlink" title="stat函数"></a>stat函数</h5><p> 作用：<font color = red>获取文件信息</font></p>
<p> 头文件：include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;unistd.h&gt;</p>
<p> 函数原型：<code>int stat(const char *path, struct stat *buf)</code></p>
<p> 返回值：成功返回0，失败返回-1；</p>
<p> 参数：文件路径（名），struct stat 类型的结构体</p>
<p>struct stat 结构体详解：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">dev_t</span>     st_dev;     <span class="comment">/* ID of device containing file */</span>文件使用的设备号</span><br><span class="line">    <span class="keyword">ino_t</span>     st_ino;     <span class="comment">/* inode number */</span>    索引节点号 </span><br><span class="line">    <span class="keyword">mode_t</span>    st_mode;    <span class="comment">/* protection */</span>  文件对应的模式，文件，目录等</span><br><span class="line">    <span class="keyword">nlink_t</span>   st_nlink;   <span class="comment">/* number of hard links */</span>    文件的硬连接数  </span><br><span class="line">    <span class="keyword">uid_t</span>     st_uid;     <span class="comment">/* user ID of owner */</span>    所有者用户识别号</span><br><span class="line">    <span class="keyword">gid_t</span>     st_gid;     <span class="comment">/* group ID of owner */</span>   组识别号  </span><br><span class="line">    <span class="keyword">dev_t</span>     st_rdev;    <span class="comment">/* device ID (if special file) */</span> 设备文件的设备号</span><br><span class="line">    <span class="keyword">off_t</span>     st_size;    <span class="comment">/* total size, in bytes */</span> 以字节为单位的文件容量   </span><br><span class="line">    <span class="keyword">blksize_t</span> st_blksize; <span class="comment">/* blocksize for file system I/O */</span> 包含该文件的磁盘块的大小   </span><br><span class="line">    <span class="keyword">blkcnt_t</span>  st_blocks;  <span class="comment">/* number of 512B blocks allocated */</span> 该文件所占的磁盘块  </span><br><span class="line">    <span class="keyword">time_t</span>    st_atime;   <span class="comment">/* time of last access */</span> 最后一次访问该文件的时间   </span><br><span class="line">    <span class="keyword">time_t</span>    st_mtime;   <span class="comment">/* time of last modification */</span> /最后一次修改该文件的时间   </span><br><span class="line">    <span class="keyword">time_t</span>    st_ctime;   <span class="comment">/* time of last status change */</span> 最后一次改变该文件状态的时间   </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>stat结构体中的st_mode 则定义了下列数种情况：</p>
<pre><code>S_IFMT   0170000    文件类型的位遮罩
S_IFSOCK 0140000    套接字
S_IFLNK 0120000     符号连接
S_IFREG 0100000     一般文件
S_IFBLK 0060000     区块装置
S_IFDIR 0040000     目录
S_IFCHR 0020000     字符装置
S_IFIFO 0010000     先进先出

S_ISUID 04000     文件的(set user-id on execution)位
S_ISGID 02000     文件的(set group-id on execution)位
S_ISVTX 01000     文件的sticky位

S_IRUSR(S_IREAD) 00400     文件所有者具可读取权限
S_IWUSR(S_IWRITE)00200     文件所有者具可写入权限
S_IXUSR(S_IEXEC) 00100     文件所有者具可执行权限

S_IRGRP 00040             用户组具可读取权限
S_IWGRP 00020             用户组具可写入权限
S_IXGRP 00010             用户组具可执行权限

S_IROTH 00004             其他用户具可读取权限
S_IWOTH 00002             其他用户具可写入权限
S_IXOTH 00001             其他用户具可执行权限

上述的文件类型在POSIX中定义了检查这些类型的宏定义：
S_ISLNK (st_mode)    判断是否为符号连接
S_ISREG (st_mode)    是否为一般文件
S_ISDIR (st_mode)    是否为目录
S_ISCHR (st_mode)    是否为字符装置文件
S_ISBLK (s3e)        是否为先进先出
S_ISSOCK (st_mode)   是否为socket
若一目录具有sticky位(S_ISVTX)，则表示在此目录下的文件只能被该文件所有者、此目录所有者或root来删除或改名，在linux中，最典型的就是这个/tmp目录啦。</code></pre><p>st_mode 的结构</p>
<p>st_mode 主要包含了 3 部分信息：</p>
<p>15-12 位保存文件类型</p>
<p>11-9 位保存执行文件时设置的信息</p>
<p>8-0 位保存文件访问权限</p>
<h5 id="getpwuid"><a href="#getpwuid" class="headerlink" title="getpwuid()"></a>getpwuid()</h5><p>头文件：#include &lt;sys/types.h&gt;  #include &lt;pwd.h&gt;</p>
<p>getpwuid函数是通过用户的uid查找用户的passwd数据。如果出错时，它们都返回一个空<a href="https://baike.baidu.com/item/指针/2878304" target="_blank" rel="noopener">指针</a>并设置errno的值，用户可以根据perror函数查看出错的信息。</p>
<p>函数说明</p>
<p><font color =red>查找用户的passwd数据</font></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">和系统数据相关的passwd 结构 </span><br><span class="line">和系统数据相关的一个结构passwd定义如下 </span><br><span class="line"><span class="comment">/* The passwd structure.      */</span> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">passwd</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">      <span class="keyword">char</span> *pw_name;       <span class="comment">/* 用户名*/</span> </span><br><span class="line">      <span class="keyword">char</span> *pw_passwd;     <span class="comment">/* 密码.*/</span> </span><br><span class="line">      <span class="keyword">__uid_t</span> pw_uid;      <span class="comment">/* 用户ID.*/</span> </span><br><span class="line">      <span class="keyword">__gid_t</span> pw_gid;      <span class="comment">/*组ID.*/</span> </span><br><span class="line">      <span class="keyword">char</span> *pw_gecos;      <span class="comment">/*真实名*/</span> </span><br><span class="line">      <span class="keyword">char</span> *pw_dir;        <span class="comment">/* 主目录.*/</span> </span><br><span class="line">      <span class="keyword">char</span> *pw_shell;      <span class="comment">/*使用的shell*/</span> </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pwd.h&gt; </span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">       <span class="class"><span class="keyword">struct</span> <span class="title">passwd</span> *<span class="title">passwd</span>;</span> </span><br><span class="line">       passwd=getpwuid(getuid()); </span><br><span class="line">       <span class="comment">/** passwd=getcwnam("phpos"); **/</span> </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"Username:%s/n"</span>,passwd-&gt;pw_name); </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"Password:%s/n"</span>,passwd-&gt;pw_passwd); </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"uid:%d/n"</span>,passwd-&gt;pw_uid); </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"gid:%d/n"</span>,passwd-&gt;pw_gid); </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"shell:%s/n"</span>,passwd-&gt;pw_shell); </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"dir:%s/n"</span>,passwd-&gt;pw_dir); </span><br><span class="line">       <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="getgrgid"><a href="#getgrgid" class="headerlink" title="getgrgid()"></a>getgrgid()</h5><p><strong>C语言getgrgid()函数：从组文件中取得指定gid的数据</strong></p>
<p>头文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;grp.h&gt;  #include &lt;sys/types.h&gt;</span><br></pre></td></tr></table></figure>

<p>定义函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strcut group * getgrgid(gid_t gid);</span><br></pre></td></tr></table></figure>

<p>函数说明：getgrgid()用来依参数gid 指定的组识别码逐一搜索组文件, 找到时便将该组的数据以group 结构返回. 返回值：返回 group 结构数据, 如果返回NULL 则表示已无数据, 或有错误发生.</p>
<p>通过gid,找到该组的相关信息,并以group结构体返回其信息, 头文件:#include &lt;grp.h&gt;,#include &lt;sys/types.h&gt; 参数     文件所属组的组id; 返回值:成功返回group结构体,错误返回NULL; group结构体: struct group { char <em>gr_name; /*组名称</em>/ char <em>gr_passwd; /</em> 组密码<em>/ gid_t gr_gid; /*组识别码</em>/ char <em><em>gr_mem; /</em>组成员账号</em>/ } 看个例子:</p>
<p>范例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* 取得gid＝3 的组数据 */</span><br><span class="line">#include &lt;grp.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">  strcut group *data;</span><br><span class="line">  int i = 0;</span><br><span class="line">  data = getgrgid(3);</span><br><span class="line">  printf(&quot;%s:%s:%d:&quot;, data-&gt;gr_name, data-&gt;gr_passwd, data-&gt;gr_gid);</span><br><span class="line">    while(data-&gt;gr_mem[i])</span><br><span class="line">    printf(&quot;%s, &quot;, data-&gt;mem[i++]);</span><br><span class="line">    printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">passwd</span>  </span></span><br><span class="line"><span class="class">&#123;</span>  </span><br><span class="line">    <span class="keyword">char</span> * pw_name; <span class="comment">/* Username, POSIX.1 */</span>  </span><br><span class="line">    <span class="keyword">char</span> * pw_passwd; <span class="comment">/* Password */</span>  </span><br><span class="line">    <span class="keyword">__uid_t</span> pw_uid; <span class="comment">/* User ID, POSIX.1 */</span>  </span><br><span class="line">    <span class="keyword">__gid_t</span> pw_gid; <span class="comment">/* Group ID, POSIX.1 */</span>  </span><br><span class="line">    <span class="keyword">char</span> * pw_gecos; <span class="comment">/* Real Name or Comment field */</span>  </span><br><span class="line">    <span class="keyword">char</span> * pw_dir; <span class="comment">/* Home directory, POSIX.1 */</span>  </span><br><span class="line">    <span class="keyword">char</span> * pw_shell; <span class="comment">/* Shell Program, POSIX.1 */</span>  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">group</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> *gr_name;  <span class="comment">/* Group name */</span></span><br><span class="line">    <span class="keyword">char</span> *gr_passwd;  <span class="comment">/* password */</span></span><br><span class="line">    <span class="keyword">__gid_t</span> gr_gid;  <span class="comment">/* Group ID */</span></span><br><span class="line">    <span class="keyword">char</span> **gr_mem;  <span class="comment">/* Member list */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span><span class="comment">//</span></span></span><br></pre></td></tr></table></figure>

<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;grp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;pwd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FILEMAX 1024</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NAMEMAX 256</span></span><br><span class="line"><span class="keyword">int</span> flag_a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> flag_l = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fg_c, bg_c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> names[FILEMAX][NAMEMAX];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">size_window</span><span class="params">(<span class="keyword">char</span> filename[][NAMEMAX],<span class="keyword">int</span> cnt, <span class="keyword">int</span> *row,<span class="keyword">int</span> *col)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">winsize</span> <span class="title">size</span>;</span></span><br><span class="line">    <span class="keyword">int</span> len[cnt] , max = <span class="number">0</span>, total = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(len, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*cnt);</span><br><span class="line">    <span class="comment">/*if(isatty(STDOUT_DILENO) == 0) &#123;</span></span><br><span class="line"><span class="comment">        exit(1);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">//struct winsize size;</span></span><br><span class="line">    <span class="comment">//ioctl(STDIN_FILENO,TIOCGWINSZ,&amp;size);</span></span><br><span class="line">    <span class="keyword">if</span>(ioctl(STDIN_FILENO, TIOCGWINSZ, &amp;size) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"ioctal"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"window size row = %d, col = %d\n"</span>, size.ws_row, size.ws_col);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cnt; i++) &#123;</span><br><span class="line">        len[i] = <span class="built_in">strlen</span>(filename[i]);</span><br><span class="line">        <span class="keyword">if</span>(max &lt; len[i])max = len[i];</span><br><span class="line">        total += len[i] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(max + <span class="number">1</span> &gt;= size.ws_col) &#123;</span><br><span class="line">        *row = cnt;</span><br><span class="line">        *col = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(total &lt;= size.ws_col) &#123;</span><br><span class="line">        *row = <span class="number">1</span>;</span><br><span class="line">        *col = cnt;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> try_begin = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, tmp = <span class="number">0</span>; i &lt; cnt; i++) &#123;</span><br><span class="line">        tmp += (len[i] + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(tmp &gt;= size.ws_col) &#123;</span><br><span class="line">            try_begin = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = try_begin;;i--) &#123;</span><br><span class="line">        <span class="keyword">int</span> *wide = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * i);</span><br><span class="line">        <span class="built_in">memset</span>(wide, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>) * i);</span><br><span class="line">        *row =(<span class="keyword">int</span>)<span class="built_in">ceil</span>(cnt / i);</span><br><span class="line">        <span class="keyword">int</span> try_sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; i; x ++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> y = x * *row; y &lt; (x + <span class="number">1</span>) * *row &amp;&amp; y &lt; cnt; y++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(wide[x] &lt; len[y])wide[x] = len[y];</span><br><span class="line">            &#125;</span><br><span class="line">            try_sum += (wide[x] + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(try_sum &gt; size.ws_col)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(try_sum &lt;= size.ws_col) &#123;</span><br><span class="line">            *col = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_color</span><span class="params">(<span class="keyword">mode_t</span> mode)</span> </span>&#123;</span><br><span class="line">    bg_c = <span class="number">1</span>;</span><br><span class="line">    fg_c = <span class="number">37</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; (S_IXUSR | S_IXGRP | S_IXOTH)) &#123;</span><br><span class="line">        fg_c = <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span>(mode &amp; S_IFMT) &#123;</span><br><span class="line">        <span class="keyword">case</span> S_IFDIR :</span><br><span class="line">        fg_c = <span class="number">34</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> S_IFLNK :</span><br><span class="line">        fg_c = <span class="number">36</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_files</span><span class="params">(<span class="keyword">char</span> filename[][NAMEMAX], <span class="keyword">int</span> cnt, <span class="keyword">int</span> row, <span class="keyword">int</span> col)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> wide_file[cnt];</span><br><span class="line">    <span class="built_in">memset</span>(wide_file, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>) * cnt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; col; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = (i * row); j &lt; (i + <span class="number">1</span>) * row &amp;&amp; j &lt; cnt; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(wide_file[i] &lt; <span class="built_in">strlen</span>(filename[j])) wide_file[i] = <span class="built_in">strlen</span>(filename[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">tmp_st</span>;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span>  j = i; j &lt; i + (row * col) &amp;&amp; j &lt; cnt; j = j + row) &#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = j / row;</span><br><span class="line">            lstat(filename[j], &amp;tmp_st);</span><br><span class="line">            update_color(tmp_st.st_mode);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\033[%d;%dm%-*s\033[0m"</span>,bg_c,fg_c ,wide_file[tmp] + <span class="number">1</span>, filename[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mode_to_str</span><span class="params">(<span class="keyword">mode_t</span> mode, <span class="keyword">char</span> *str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(S_ISREG(mode))str[<span class="number">0</span>] = <span class="string">'-'</span>;</span><br><span class="line">    <span class="keyword">if</span>(S_ISDIR(mode))str[<span class="number">0</span>] = <span class="string">'d'</span>;</span><br><span class="line">    <span class="keyword">if</span>(S_ISCHR(mode))str[<span class="number">0</span>] = <span class="string">'c'</span>;</span><br><span class="line">    <span class="keyword">if</span>(S_ISBLK(mode))str[<span class="number">0</span>] = <span class="string">'b'</span>;</span><br><span class="line">    <span class="keyword">if</span>(S_ISSOCK(mode))str[<span class="number">0</span>] = <span class="string">'s'</span>;</span><br><span class="line">    <span class="keyword">if</span>(S_ISLNK(mode))str[<span class="number">0</span>] = <span class="string">'l'</span>;</span><br><span class="line">    <span class="keyword">if</span>(S_ISFIFO(mode))str[<span class="number">0</span>] = <span class="string">'p'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IRUSR) str[<span class="number">1</span>] = <span class="string">'r'</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IWUSR) str[<span class="number">2</span>] = <span class="string">'w'</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IXUSR) str[<span class="number">3</span>] = <span class="string">'x'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IRGRP) str[<span class="number">4</span>] = <span class="string">'r'</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IWGRP) str[<span class="number">5</span>] = <span class="string">'w'</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IXGRP) str[<span class="number">6</span>] = <span class="string">'x'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IROTH) str[<span class="number">7</span>] = <span class="string">'r'</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IWOTH) str[<span class="number">8</span>] = <span class="string">'w'</span>;</span><br><span class="line">    <span class="keyword">if</span>(mode &amp; S_IXOTH) str[<span class="number">9</span>] = <span class="string">'x'</span>;</span><br><span class="line">    <span class="keyword">if</span>((mode &amp; S_IXUSR) &amp;&amp; (mode &amp; S_ISUID)) str[<span class="number">3</span>] = <span class="string">'s'</span>;</span><br><span class="line">    update_color(mode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">uid_to_name</span><span class="params">(<span class="keyword">uid_t</span> uid)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">passwd</span> *<span class="title">pw_ptr</span>;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> tmpstr[<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>((pw_ptr = getpwuid(uid)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">sprintf</span>(tmpstr, <span class="string">"%d"</span>, uid);</span><br><span class="line">        <span class="keyword">return</span> tmpstr;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pw_ptr-&gt;pw_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">gid_to_name</span><span class="params">(<span class="keyword">gid_t</span> gid)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">group</span> *<span class="title">gr_ptr</span>;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> tmpstr[<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>((gr_ptr = getgrgid(gid)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">sprintf</span>(tmpstr, <span class="string">"%d"</span> , gid);</span><br><span class="line">        <span class="keyword">return</span> tmpstr;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gr_ptr-&gt;gr_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_info</span><span class="params">(<span class="keyword">char</span> *filename, struct stat *info)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> modestr[<span class="number">11</span>] = <span class="string">"----------"</span>;</span><br><span class="line">    mode_to_str(info-&gt;st_mode, modestr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s "</span>, modestr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%4ld "</span>, info-&gt;st_nlink);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%10s "</span>, uid_to_name(info-&gt;st_uid));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%10s "</span>, gid_to_name(info-&gt;st_gid));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%10ld "</span>, info-&gt;st_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.15s "</span>,<span class="number">4</span> + ctime(&amp;info-&gt;st_mtime));</span><br><span class="line">    <span class="comment">/*if(S_ISDIR(info-&gt;st_mode)) &#123;</span></span><br><span class="line"><span class="comment">    printf("\033[1;34m%s\033[0m\n",filename);</span></span><br><span class="line"><span class="comment">    &#125; else &#123;</span></span><br><span class="line"><span class="comment">        printf("%s\n", filename);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="keyword">if</span>(modestr[<span class="number">0</span>] == <span class="string">'l'</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\033[%d;%dm%s\033[0m"</span>, bg_c,fg_c , filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(modestr[<span class="number">0</span>] == <span class="string">'l'</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> cnt;</span><br><span class="line">        <span class="keyword">char</span> buf[NAMEMAX] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>((cnt = readlink(filename, buf,NAMEMAX )) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">"readlink"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"-&gt; %s\n"</span>, buf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\033[%d;%dm%s\033[0m\n"</span>, bg_c,fg_c , filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_stat</span><span class="params">(<span class="keyword">char</span> *filename)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">st</span>;</span></span><br><span class="line">    <span class="keyword">if</span>(lstat(filename, &amp;st) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(filename);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        show_info(filename, &amp;st);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp_name</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *_a, <span class="keyword">const</span> <span class="keyword">void</span> *_b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *a = (<span class="keyword">char</span> *)_a;</span><br><span class="line">    <span class="keyword">char</span> *b = (<span class="keyword">char</span> *)_b;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strcmp</span>(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_ls</span><span class="params">(<span class="keyword">char</span> *dirname)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//printf("Doing with dir %s\n", dirname);</span></span><br><span class="line">    DIR *dirp = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> *<span class="title">direntp</span>;</span></span><br><span class="line">    <span class="keyword">if</span>((dirp = opendir(dirname)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(access(dirname, R_OK) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(flag_l == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">tmp_st</span>;</span></span><br><span class="line">                lstat(dirname, &amp;tmp_st);</span><br><span class="line">                update_color(tmp_st.st_mode);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"\033[%d;%dm%s\033[0m\n"</span>,bg_c, fg_c, dirname);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                do_stat(dirname);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            perror(dirname);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s:\n"</span>, dirname);</span><br><span class="line">        chdir(dirname);</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((direntp = readdir(dirp))!=<span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(direntp-&gt;d_name[<span class="number">0</span>] ==<span class="string">'.'</span>&amp;&amp;(flag_a == <span class="number">0</span>)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">strcpy</span>(names[cnt++], direntp-&gt;d_name);</span><br><span class="line">        &#125;</span><br><span class="line">        qsort(names, cnt, NAMEMAX, cmp_name);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(flag_l == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cnt; i++) &#123;</span><br><span class="line">                do_stat(names[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//printf("Print all file \n");</span></span><br><span class="line">             <span class="keyword">int</span> row, col;</span><br><span class="line">            size_window(names, cnt, &amp;row, &amp;col);</span><br><span class="line">            <span class="comment">// printf("row =%d, col = %d\n", row, col);</span></span><br><span class="line">            show_files(names, cnt, row, col);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> opt;</span><br><span class="line">    <span class="keyword">while</span>((opt = getopt(argc, argv, <span class="string">"al"</span> )) !=<span class="number">-1</span> ) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'a'</span> :flag_a = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'l'</span> :flag_l = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Usage : %s [-al] [filename]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf("flag_a = %d, flag_l = %d\n", flag_a, flag_l);</span></span><br><span class="line">   <span class="comment">// printf("optind = %d\n", optind);</span></span><br><span class="line">    argc -= (optind - <span class="number">1</span>);</span><br><span class="line">    argv += (optind - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//printf("argv=%s\n", *(argv+1));</span></span><br><span class="line">    <span class="keyword">if</span>(argc == <span class="number">1</span>) &#123;</span><br><span class="line">        do_ls(<span class="string">"."</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(--argc) &#123;</span><br><span class="line">            do_ls(*(++argv));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现more函数"><a href="#实现more函数" class="headerlink" title="实现more函数"></a>实现more函数</h4><h5 id="fopen函数"><a href="#fopen函数" class="headerlink" title="fopen函数"></a>fopen函数</h5><p><strong>函数功能：</strong>打开一个文件</p>
<p><strong>函数原型：</strong>FILE * f<a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=593034&ss_c=ssc.citiao.link" target="_blank" rel="noopener">open</a>(<a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=7610856&ss_c=ssc.citiao.link" target="_blank" rel="noopener">const</a> <a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=4836436&ss_c=ssc.citiao.link" target="_blank" rel="noopener">char</a> * <a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=7872928&ss_c=ssc.citiao.link" target="_blank" rel="noopener">path</a>,const char * <a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=4766078&ss_c=ssc.citiao.link" target="_blank" rel="noopener">mode</a>);</p>
<p><strong>返回值：</strong>文件顺利打开后，指向该流的文件指针就会被返回。如果文件打开失败则返回NULL，并把<a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=62665122" target="_blank" rel="noopener">错误代码</a>存在<a href="http://www.cnblogs.com/lemma/ShowInnerLink.htm?lemmaId=70889372&ss_c=ssc.citiao.link" target="_blank" rel="noopener">errno</a> 中。</p>
<p>#####　fgets函数</p>
<p>函数原型</p>
<p>char *fgets(char *str, int n, FILE *stream);</p>
<p>参数</p>
<ul>
<li><strong>str</strong>– 这是指向一个字符数组的指针，该数组存储了要读取的字符串。</li>
<li><strong>n</strong>– 这是要读取的最大字符数（包括最后的空字符）。通常是使用以 str 传递的数组长度。</li>
<li><strong>stream</strong>– 这是指向 FILE 对象的指针，该 FILE 对象标识了要从中读取字符的流。</li>
</ul>
<h5 id="fgetc函数"><a href="#fgetc函数" class="headerlink" title="fgetc函数"></a>fgetc函数</h5><p>fgetc是一种计算机<a href="https://baike.baidu.com/item/C语言/105958" target="_blank" rel="noopener">C语言</a>中的函数。意为从<a href="https://baike.baidu.com/item/文件指针/1953678" target="_blank" rel="noopener">文件指针</a>stream指向的文件中读取一个字符，读取一个字节后，光标位置后移一个字节。格式：int fgetc(FILE *stream);。</p>
<ul>
<li><p>功  能</p>
<p>函数从流中返回一个字符值</p>
</li>
</ul>
<ul>
<li><p>返回值</p>
<p>得到的字符值</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LENLINE 512</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;termios.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;termios.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> PAGLINE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">winsize</span> <span class="title">size</span>;</span></span><br><span class="line">    ioctl(STDIN_FILENO,TIOCGWINSZ,&amp;size);</span><br><span class="line">    PAGLINE = size.ws_row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_cmd</span><span class="params">(FILE *fp)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"more:"</span>);</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">    <span class="keyword">while</span>((c = fgetc(fp))!=EOF) &#123;</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="string">'q'</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(c == <span class="string">' '</span>) <span class="keyword">return</span> PAGLINE;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(c == <span class="string">'\n'</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_more</span><span class="params">(FILE *fp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> line[LENLINE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    FILE *cmd = fopen(<span class="string">"/dev/tty"</span>, <span class="string">"r"</span>);</span><br><span class="line">    <span class="keyword">int</span> num_line = <span class="number">0</span>, reply, get_cmd(FILE *);</span><br><span class="line">    <span class="keyword">while</span>(fgets(line, LENLINE, fp)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(num_line == PAGLINE) &#123;</span><br><span class="line">            reply = get_cmd(cmd);</span><br><span class="line">            <span class="keyword">if</span>(reply == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            num_line -= reply;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fputs</span>(line, <span class="built_in">stdout</span>) == EOF) &#123;</span><br><span class="line">            perror(<span class="string">"fputs"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        num_line++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    f();</span><br><span class="line">    <span class="keyword">if</span>(argc == <span class="number">1</span>) &#123;</span><br><span class="line">        do_more(<span class="built_in">stdin</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(--argc) &#123;</span><br><span class="line">            <span class="keyword">if</span>((fp = fopen(*++argv,<span class="string">"r"</span>))!=<span class="literal">NULL</span>) &#123;</span><br><span class="line">                do_more(fp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h1 id="数据提取操作"><a href="#数据提取操作" class="headerlink" title="数据提取操作"></a>数据提取操作</h1><ul>
<li>数据提取操作</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>cut</td>
<td>切分</td>
<td>grep</td>
<td>检索</td>
</tr>
<tr>
<td>sort</td>
<td>排序</td>
<td>wc</td>
<td>统计字符字数行数</td>
</tr>
<tr>
<td>uniq</td>
<td>去重</td>
<td>tee</td>
<td>双重导向</td>
</tr>
<tr>
<td>split</td>
<td>文件切分</td>
<td>xargs</td>
<td>参数代换</td>
</tr>
<tr>
<td>tr</td>
<td>替换压缩删除</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><p>cut切分<br>cut [-dfc] <file><br>-d c:以字符分割<br>-f num：显示ｎｕｍ字段内容【ｎ- ;n - m; -m】<br>-c num: 字节<br>-b num: 字符</p>
</li>
<li><p>grep检索<br>grep [-acinv] <string> <file><br>-a: 将二进制文件以普通文件形式搜寻数据<br>-c : 统计搜寻到的次数<br>-i：忽略大小写<br>-n：顺序输出行号<br>-v：反向输出（输出没找到的）</p>
</li>
<li><p>sort排序</p>
<p>sort [-fnMnrtuk] <file_or_stdio></p>
<p>-f:忽略大小写</p>
<p>-b:忽略最前面的空格符</p>
<p>-M:以月份名称排序</p>
<p>-n:以纯数字方式排序</p>
<p>-r:反向排序</p>
<p>-u:uniq</p>
<p>-t:分隔符，默认[TAB]</p>
<p>-k:以那个区间排序</p>
</li>
</ul>
<ul>
<li><p>wc统计字符字数，行数</p>
<p>wc [-lwm] <file_or_stdin></p>
<p>-l: 仅列出行号</p>
<p>-w:仅列出多少字</p>
<p>-m:仅列出多少字符</p>
</li>
<li><p>uniq去重</p>
<p>uniq [-ic]</p>
<p>-i :忽略大小写字符的不同</p>
<p>-c:进行计数</p>
</li>
<li><p>split文件切分</p>
<p>split [-bl] <file> PREFIX</p>
<p>-b SIZE: 切分为ＳＩＺＥ大小的文件</p>
<p>-l ｎｕｍ：以ｎｕｍ行为大小切</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc | splist -l 10</span><br></pre></td></tr></table></figure>

<ul>
<li><p>xargs参数xargs替换</p>
<p>-0：将特殊字符还原为普通字符</p>
<p>-eEOF:当xargs读到ＥＯＦ时停止</p>
<p>-p:执行指令前询问</p>
<p>-n num:每次执行command时需要的参数个数</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd | cut -d ":" -f 1 | xargs -n 1 -efangsong id</span><br></pre></td></tr></table></figure>

<ul>
<li><p>tr替换压缩删除  </p>
<p>tr [cdst] &lt;字符集&gt;　&lt;字符集&gt;</p>
<p>c 取代所有不属于第一字符集的字符</p>
<p>d 删除所有属于第一字符集的字符</p>
<p>s 将连续重复的字符以单独一个字符表示</p>
<p>t 先删除第一字符集比第二字符集字符集多的字符</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> cat fangsong | tr [0-9] [a-z]</span><br><span class="line"> cat fangsong | tr -d [0-9]</span><br><span class="line"> cat fangsong | tr -s [a-z]</span><br><span class="line"> cat fangsong | tr -t [0-9] [a-z]</span><br><span class="line"></span><br><span class="line"> 文件夹下文件名大写变小写</span><br><span class="line">ls | tr [a - z] [A  - Z]</span><br><span class="line">for i in `ls`; do</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">mv <span class="variable">$i</span> `<span class="built_in">echo</span> <span class="variable">$i</span>` | tr [a-z] [A-Z]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="keyword">done</span></span></span><br></pre></td></tr></table></figure>

<p>如何统计文件中单词的个数，逆序输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat fangsong | tr -s -c [a-z] ' ' | tr ' ' '\n' | sort | uniq -c | sort -n -r | head -n 20</span><br><span class="line">先把不是字符的去掉，然后把空格替换为'\n',然后排序去重然后逆序输出前二十行</span><br></pre></td></tr></table></figure>



<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><h3 id="用户管理的重要配置文件"><a href="#用户管理的重要配置文件" class="headerlink" title="用户管理的重要配置文件"></a><strong>用户管理的重要配置文件</strong></h3><table>
<thead>
<tr>
<th>配置文件</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>/etc/passwd</td>
<td>用户名　密码为　用户编号　归属组编号　姓名　$HOME　$SHELL</td>
</tr>
<tr>
<td>/etc/shadow</td>
<td>用户名　已加密密码　密码改动信息　密码策略</td>
</tr>
<tr>
<td>/etc/group</td>
<td>群组名　密码为　群组编号　组内用户</td>
</tr>
<tr>
<td>/etc/gshadow</td>
<td>群组密码相关文件</td>
</tr>
<tr>
<td>/etc/sudoers</td>
<td>用户名　权限定义　权限(sudo)</td>
</tr>
</tbody></table>
<h4 id="etc-password文件说明"><a href="#etc-password文件说明" class="headerlink" title="/etc/password文件说明"></a><strong>/etc/password文件说明</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:/etc$ cat passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>root</th>
<th>x</th>
<th>0</th>
<th>0</th>
<th>root</th>
<th>/root</th>
<th>/bin/bash</th>
</tr>
</thead>
<tbody><tr>
<td>账户名称</td>
<td>密码</td>
<td>uid</td>
<td>gid</td>
<td>用户信息</td>
<td>$HOME</td>
<td>SHELL</td>
</tr>
</tbody></table>
<h4 id="etc-shadow文件说明"><a href="#etc-shadow文件说明" class="headerlink" title="/etc/shadow文件说明"></a><strong>/etc/shadow文件说明</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root:!:18225:0:99999:7:::</span><br><span class="line">daemon:*:18002:0:99999:7:::</span><br><span class="line">bin:*:18002:0:99999:7:::</span><br><span class="line">sys:*:18002:0:99999:7:::</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>root</th>
<th>!</th>
<th>18225</th>
<th>0</th>
<th>99999</th>
<th>7</th>
<th>null</th>
<th>null</th>
<th>null</th>
</tr>
</thead>
<tbody><tr>
<td>账户名称</td>
<td>密码</td>
<td>修改密码的日期</td>
<td>密码不可更改日期</td>
<td>密码需要重新修改日期</td>
<td>密码更新期限清高日期</td>
<td>密码过期的宽限时间</td>
<td>账户失效日期</td>
<td>保留</td>
</tr>
</tbody></table>
<h4 id="etc-group文件说明"><a href="#etc-group文件说明" class="headerlink" title="/etc/group文件说明"></a><strong>/etc/group文件说明</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adm:x:4:syslog,fangsong</span><br><span class="line">tty:x:5:</span><br><span class="line">disk:x:6:</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>adm</th>
<th>x</th>
<th>4</th>
<th>syslog,fangsong</th>
</tr>
</thead>
<tbody><tr>
<td>组名</td>
<td>群组密码</td>
<td>gid</td>
<td>支持的账户</td>
</tr>
</tbody></table>
<h4 id="etc-gshadow文件说明"><a href="#etc-gshadow文件说明" class="headerlink" title="/etc/gshadow文件说明"></a><strong>/etc/gshadow文件说明</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lpadmin:!::fangsong,saned</span><br><span class="line">scanner:!::</span><br><span class="line">avahi:!::</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>lpadmin</th>
<th>!</th>
<th>null</th>
<th>fangsong,saned</th>
</tr>
</thead>
<tbody><tr>
<td>组名</td>
<td>密码</td>
<td>群组管理员</td>
<td>加入该群组的所属账号</td>
</tr>
</tbody></table>
<h3 id="用户管理相关的命令"><a href="#用户管理相关的命令" class="headerlink" title="用户管理相关的命令"></a><strong>用户管理相关的命令</strong></h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>su</td>
<td>切换用户</td>
<td>sudo</td>
<td>临时切换root用户</td>
</tr>
<tr>
<td>passwd</td>
<td>设定用户密码</td>
<td>gpasswd</td>
<td>设定群组密码</td>
</tr>
<tr>
<td>chsh</td>
<td>更改用户shell</td>
<td>usermod</td>
<td>修改用户账号</td>
</tr>
<tr>
<td>useradd</td>
<td>新建用户</td>
<td>userdel</td>
<td>删除用户</td>
</tr>
<tr>
<td>id</td>
<td>显示用户信息</td>
<td>…</td>
<td>．．．</td>
</tr>
</tbody></table>
<h4 id="su命令"><a href="#su命令" class="headerlink" title="su命令"></a>su命令</h4><blockquote>
<p>su [-lmpfc] <username></p>
<p>-l | -1 :重新登录</p>
<p>-m | -p:不改变环境变量</p>
<p>-c comand:切换后执行命令，并退出</p>
</blockquote>
<p>####　sudo命令</p>
<blockquote>
<p>sudo [-siul] <command></p>
<p>-s :切换为root shell</p>
<p>-i:切换为root shell ，并初始化</p>
<p>-u username | uid：执行命令身份</p>
<p>-1:显示自己的权限</p>
</blockquote>
<h4 id="passwd命令"><a href="#passwd命令" class="headerlink" title="passwd命令"></a>passwd命令</h4><blockquote>
<p>passwd [-dleSxnf] <username></p>
<p>-d:清除密码</p>
<p>-l:锁定用户</p>
<p>-e:使密码过期</p>
<p>-S:显示密码认证信息</p>
<p>-x days:密码过期后最大使用天数</p>
<p>-n days:密码冻结后最小使用时间</p>
<p>-s:更改登录shell</p>
<p>-f:更改用户信息</p>
</blockquote>
<h4 id="gpasswd命令"><a href="#gpasswd命令" class="headerlink" title="gpasswd命令"></a>gpasswd命令</h4><blockquote>
<p>gpasswd [-adeAm]&lt;群组名&gt;</p>
<p>-a username :将用户加入群组</p>
<p>-d username :将用户从群组中删除</p>
<p>-r :删除密码</p>
<p>-A username:将用户设置为群组管理员</p>
<p>-M username1,username2…:设置为群成员</p>
</blockquote>
<h4 id="chsh命令"><a href="#chsh命令" class="headerlink" title="chsh命令"></a>chsh命令</h4><blockquote>
<p>chsh -s shell <username></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fangsong@fangsong-FX503VD:~$ chsh -s /bin/sh fangsong</span><br><span class="line">密码： </span><br><span class="line">fangsong@fangsong-FX503VD:~$ su - fangsong</span><br><span class="line">密码： </span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$SHELL</span></span></span><br><span class="line">/bin/sh</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">fangsong@fangsong-FX503VD:~$ chsh -s /bin/bash fangsong</span><br><span class="line">密码： </span><br><span class="line">fangsong@fangsong-FX503VD:~$ su - fangsong</span><br><span class="line">密码： </span><br><span class="line">Good evening. 天行健，君子以自强不息；地势坤，君子以厚德载物！</span><br><span class="line">Please input the username: fangsong</span><br><span class="line">fangsong is online.</span><br><span class="line">fangsong@fangsong-FX503VD:~$ echo $SHELL</span><br><span class="line">/bin/bash</span><br><span class="line">fangsong@fangsong-FX503VD:~$</span><br></pre></td></tr></table></figure>

<h4 id="useradd命令添加新的用户账号"><a href="#useradd命令添加新的用户账号" class="headerlink" title="useradd命令添加新的用户账号"></a>useradd命令添加新的用户账号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd 选项 用户名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>useradd [-dMsugGnefcD] <username></p>
<p>-d dir:指定$HOME</p>
<p>-m:自动建立$HOME</p>
<p>-M:不自动建立$HOME</p>
<p>-s shell:设置用户登录ｓｈｅｌｌ</p>
<p>-u uid:设置用户编号</p>
<p>-g groupname:设定用户归属群组</p>
<p>-G groupname:设置用户归属附加群组</p>
<p>-n:不建立以用户名称为群组名称的群组</p>
<p>-e days:设置账号过期时间</p>
<p>-f days:缓冲时间,days天后关闭账号</p>
<p>-c string:设置用户备注</p>
<p>-D[表达式]:更改预设值</p>
</blockquote>
<blockquote>
<p>/etc/login.defs新建用户规则</p>
<p>/etc/skel/新建用户默认文件</p>
</blockquote>
<p>实例1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># useradd –d  /home/sam -m sam</span><br></pre></td></tr></table></figure>

<p>此命令创建了一个用户sam，其中-d和-m选项用来为登录名sam产生一个主目录 /home/sam（/home为默认的用户主目录所在的父目录）。</p>
<p>实例2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># useradd -s /bin/sh -g group –G adm,root gem</span><br></pre></td></tr></table></figure>

<p>此命令新建了一个用户gem，该用户的登录Shell是 <code>/bin/sh</code>，它属于group用户组，同时又属于adm和root用户组，其中group用户组是其主组。</p>
<p>这里可能新建组：<code>#groupadd group及groupadd adm</code></p>
<p>增加用户账号就是在/etc/passwd文件中为新用户增加一条记录，同时更新其他系统文件如/etc/shadow, /etc/group等。</p>
<p>Linux提供了集成的系统管理工具userconf，它可以用来对用户账号进行统一管理。</p>
<p>####　userdel 用户名删除帐号</p>
<blockquote>
<p>userdel -r <username></p>
<p>-r :删除用户相关文件和目录</p>
</blockquote>
<p>如果一个用户的账号不再使用，可以从系统中删除。删除用户账号就是要将/etc/passwd等系统文件中的该用户记录删除，必要时还删除用户的主目录。</p>
<p>删除一个已有的用户账号使用<code>userdel</code>命令，其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel 选项 用户名</span><br></pre></td></tr></table></figure>

<p>常用的选项是 <strong>-r</strong>，它的作用是把用户的主目录一起删除。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># userdel -r sam</span><br></pre></td></tr></table></figure>

<p>此命令删除用户sam在系统文件中（主要是/etc/passwd, /etc/shadow, /etc/group等）的记录，同时删除用户的主目录。</p>
<h4 id="usermode-命令"><a href="#usermode-命令" class="headerlink" title="usermode 命令"></a>usermode 命令</h4><blockquote>
<p>usermod [-cdefgGlLsuU] <username></p>
<p>-c string :修改备注信息</p>
<p>-d dir:修改$HOME</p>
<p>-e dats:密码期限</p>
<p>-f days:密码过期后宽限的日期</p>
<p>-g groupname:修改用户所属群组</p>
<p>-G groupname:修改用户所属附加群组</p>
</blockquote>
<h4 id="usermod-命令修改帐号"><a href="#usermod-命令修改帐号" class="headerlink" title="usermod 命令修改帐号"></a>usermod 命令修改帐号</h4><blockquote>
<p>usermod [-defgGlLsuU]<username></p>
<p>-l username : 修改用户账号名称</p>
<p>-L:锁定用户密码，使密码无效</p>
<p>-s shell:修改用户登录后所使用的shell</p>
<p>-u uid:修改用户ID</p>
<p>-U:接除密码锁定</p>
</blockquote>
<p>修改用户账号就是根据实际情况更改用户的有关属性，如用户号、主目录、用户组、登录Shell等。</p>
<p>修改已有用户的信息使用<code>usermod</code>命令，其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod 选项 用户名</span><br></pre></td></tr></table></figure>

<p>常用的选项包括<code>-c, -d, -m, -g, -G, -s, -u以及-o等</code>，这些选项的意义与<code>useradd</code>命令中的选项一样，可以为用户指定新的资源值。</p>
<p>另外，有些系统可以使用选项：-l 新用户名</p>
<p>这个选项指定一个新的账号，即将原来的用户名改为新的用户名。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># usermod -s /bin/ksh -d /home/z –g developer sam</span><br></pre></td></tr></table></figure>

<p>此命令将用户sam的登录Shell修改为ksh，主目录改为/home/z，用户组改为developer。</p>
<p>####　id命令</p>
<blockquote>
<p>id [-gGnru]<username></p>
<p>-g :下属所属组ID</p>
<p>-G:显示附加组ID</p>
<p>-n:显示用户，所属组，或附加群组的名称</p>
<p>-u:显示用户ID</p>
<p>-r:显示实际ID</p>
</blockquote>
<h1 id="SOCKET编程基础"><a href="#SOCKET编程基础" class="headerlink" title="SOCKET编程基础"></a>SOCKET编程基础</h1><p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2022-47-53%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2022-48-59%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2022-49-42%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2022-50-11%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h3 id="socket-创建socket"><a href="#socket-创建socket" class="headerlink" title="socket()创建socket"></a>socket()创建socket</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">完成两个应用程序之间的数据传输, 应用程序可以通过它发送或接收数据,网络套接字是IP地址与端口的组合;</span><br></pre></td></tr></table></figure>

<p>socket()函数调用的格式</p>
<blockquote>
<p>SOCKET PASCAL FAR socket（int af，int type，int protocol）；</p>
</blockquote>
<p>参数af指定套接字使用的协议族, </p>
<p>type参数指定所需的通信类型。包括数据流（SOCK_STREAM）、数据报（SOCK-DGRAM）和原始类型（S0CK_RAW）。</p>
<p>参数protocol说明该套接字使用的协议族中的特定协议。如果调用者不希望特别指定使用的协议，则置为0，使用默认的连接模式。</p>
<p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2022-56-22%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> port, server_listen;</span><br><span class="line">    port = atoi(argv[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">if</span>((server_listen = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123; <span class="comment">// 完成两个应用程序之间的数据传输, 应用程序可以通过它发送或接收数据,网络套接字是IP地址与端口的组合;</span></span><br><span class="line">        perror(<span class="string">"socket"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="bind-绑定IP地址及端口"><a href="#bind-绑定IP地址及端口" class="headerlink" title="bind()绑定IP地址及端口"></a>bind()绑定IP地址及端口</h3><p>bind()函数通过给一个<a href="https://baike.baidu.com/item/未命名/278232" target="_blank" rel="noopener">未命名</a>套接口分配一个本地名字来为套接口建立本地捆绑（<a href="https://baike.baidu.com/item/主机地址/9765500" target="_blank" rel="noopener">主机地址</a>/<a href="https://baike.baidu.com/item/端口号/10883658" target="_blank" rel="noopener">端口号</a>）。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> struct sockaddr_in &#123;</span></span><br><span class="line"><span class="comment">     short sin_family;//Address family一般来说AF_INET（地址族）PF_INET（协议族）</span></span><br><span class="line"><span class="comment">     unsigned short sin_port; // Port number(必须要采用网络数据格式,普通数字可以用htons()函数转换成网络数据格式的数字)</span></span><br><span class="line"><span class="comment">     struct in_addr sin_addr;//IP address in network byte order（Internet address）;</span></span><br><span class="line"><span class="comment">     &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">bind(server_listen, (struct sockaddr *)&amp;server, <span class="keyword">sizeof</span>(server))</span><br><span class="line">   <span class="comment">//  返回值：成功返回0，失败返回-1.</span></span><br></pre></td></tr></table></figure>

<p>参数列表中，server_listen 表示已经建立的socket编号（描述符）；</p>
<p>server 是一个指向sockaddr结构体类型的指针；</p>
<p>参数sizeof(server)表示server结构的长度，可以用sizeof操作符获得。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server</span>;</span></span><br><span class="line">server.sin_family = AF_INET;</span><br><span class="line">server.sin_port = htons(port);</span><br><span class="line">server.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line"><span class="keyword">if</span>(bind(server_listen, (struct sockaddr *)&amp;server, <span class="keyword">sizeof</span>(server)) &lt; <span class="number">0</span>) &#123; <span class="comment">//将一本地地址与一套接口捆绑</span></span><br><span class="line">    perror(<span class="string">"bind"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="listen-监听socket"><a href="#listen-监听socket" class="headerlink" title="listen()监听socket"></a>listen()监听socket</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建一个套接口并监听申请的连接.</span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">int listen( int sockfd, int backlog);</span><br><span class="line">sockfd：用于标识一个已捆绑未连接套接口的描述字。</span><br><span class="line">backlog：等待连接队列的最大长度。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  #include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="comment">  int listen( int sockfd, int backlog);</span></span><br><span class="line"><span class="comment">  sockfd：用于标识一个已捆绑未连接套接口的描述字。</span></span><br><span class="line"><span class="comment">  backlog：等待连接队列的最大长度。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">if</span>(listen(server_listen, <span class="number">20</span>) &lt; <span class="number">0</span>) &#123; <span class="comment">// 创建一个套接口并监听申请的连接</span></span><br><span class="line">      perror(<span class="string">"server"</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2023-07-04%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h3 id="connect-建立连接"><a href="#connect-建立连接" class="headerlink" title="connect()建立连接"></a>connect()建立连接</h3><p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2023-53-13%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">connect()用于建立与指定socket的连接。</span><br><span class="line">头文件: #include &lt;sys/socket.h&gt;</span><br><span class="line">函数原型: int connect(SOCKET s, const struct sockaddr * name, int namelen);</span><br><span class="line">参数:</span><br><span class="line">s：标识一个未连接socket</span><br><span class="line">name：指向要连接套接字的sockaddr结构体的指针</span><br><span class="line">namelen：sockaddr结构体的字节长度</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"Socket create.\n"</span>);</span><br><span class="line"><span class="keyword">if</span>(connect(sockfd, (struct sockaddr *)&amp;server, <span class="keyword">sizeof</span>(server)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    perror(<span class="string">"connect"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="accept-接收连接"><a href="#accept-接收连接" class="headerlink" title="accept()接收连接"></a>accept()接收连接</h3><p>#include &lt;sys/socket.h&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">accept()是在一个套接口接受的一个连接</span><br><span class="line">     SOCKET accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);</span><br><span class="line">     sockfd：套接字描述符，该套接口在listen()后监听连接。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sockfd;</span><br><span class="line">       <span class="keyword">if</span>((sockfd = accept(server_listen, <span class="literal">NULL</span>, <span class="literal">NULL</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           perror(<span class="string">"accept"</span>);</span><br><span class="line">           close(sockfd);</span><br><span class="line">           <span class="keyword">continue</span>;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2023-48-17%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h3 id="send-发送数据"><a href="#send-发送数据" class="headerlink" title="send()发送数据"></a>send()发送数据</h3><p>  send（）是一个计算机函数，功能是向一个已经连接的socket发送数据<br>     int send( SOCKET s, const char FAR *buf, int len, int flags );<br>     不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。<br>    客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。<br>（1）第一个参数指定发送端套接字描述符；<br>（2）第二个参数指明一个存放应用程序要发送数据的缓冲区；<br>（3）第三个参数指明实际要发送的数据的字节数；<br>（4）第四个参数一般置0。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(send(sockfd, <span class="string">"fangsong"</span>, <span class="keyword">sizeof</span>(<span class="string">"fangsong"</span>), <span class="number">0</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    perror(<span class="string">"send"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="recv-接收数据"><a href="#recv-接收数据" class="headerlink" title="recv()接收数据"></a>recv()接收数据</h3><p><img src="linux%E7%AC%94%E8%AE%B0.assets/2020-03-22%2023-50-55%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(recv(sockfd, name, <span class="keyword">sizeof</span>(name), <span class="number">0</span>) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">       perror(<span class="string">"recv"</span>);</span><br><span class="line">        close(sockfd);</span><br><span class="line">     <span class="comment">// continue;</span></span><br><span class="line">    &#125;    <span class="keyword">if</span>(recv(sockfd, name, <span class="keyword">sizeof</span>(name), <span class="number">0</span>) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">       perror(<span class="string">"recv"</span>);</span><br><span class="line">        close(sockfd);</span><br><span class="line">     <span class="comment">// continue;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h1 id="实现一个socket程序"><a href="#实现一个socket程序" class="headerlink" title="实现一个socket程序"></a>实现一个socket程序</h1><h3 id="server-c"><a href="#server-c" class="headerlink" title="server.c"></a>server.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Usage: %s powrt\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> port, server_listen;</span><br><span class="line">    port = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span>((server_listen = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123; <span class="comment">// 完成两个应用程序之间的数据传输, 应用程序可以通过它发送或接收数据,网络套接字是IP地址与端口的组合;</span></span><br><span class="line">        perror(<span class="string">"socket"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     server_listen: 标识一未捆绑套接口的描述字。</span></span><br><span class="line"><span class="comment">     server: 赋予套接口的地址</span></span><br><span class="line"><span class="comment">     struct sockaddr_in &#123;</span></span><br><span class="line"><span class="comment">     short sin_family;//Address family一般来说AF_INET（地址族）PF_INET（协议族）</span></span><br><span class="line"><span class="comment">     unsigned short sin_port; // Port number(必须要采用网络数据格式,普通数字可以用htons()函数转换成网络数据格式的数字)</span></span><br><span class="line"><span class="comment">     struct in_addr sin_addr;//IP address in network byte order（Internet address）;</span></span><br><span class="line"><span class="comment">     &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server</span>;</span></span><br><span class="line">    server.sin_family = AF_INET;</span><br><span class="line">    server.sin_port = htons(port);</span><br><span class="line">    server.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="keyword">if</span>(bind(server_listen, (struct sockaddr *)&amp;server, <span class="keyword">sizeof</span>(server)) &lt; <span class="number">0</span>) &#123; <span class="comment">//将一本地地址与一套接口捆绑</span></span><br><span class="line">        perror(<span class="string">"bind"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    #include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="comment">    int listen( int sockfd, int backlog);</span></span><br><span class="line"><span class="comment">    sockfd：用于标识一个已捆绑未连接套接口的描述字。</span></span><br><span class="line"><span class="comment">    backlog：等待连接队列的最大长度。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span>(listen(server_listen, <span class="number">20</span>) &lt; <span class="number">0</span>) &#123; <span class="comment">// 创建一个套接口并监听申请的连接</span></span><br><span class="line">        perror(<span class="string">"server"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     accept()是在一个套接口接受的一个连接</span></span><br><span class="line"><span class="comment">     SOCKET accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);</span></span><br><span class="line"><span class="comment">     sockfd：套接字描述符，该套接口在listen()后监听连接。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* fork系统调用用于创建一个新进程，称为子进程，它与进程（称为系统调用fork的进程）同时运行，此进程称为父进程。创建新的子进程后，两个进程将执行fork（）系统调用之后的下一条指令。子进程使用相同的pc（程序计数器），相同的CPU寄存器，在父进程中使用的相同打开文件。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> sockfd;</span><br><span class="line">        <span class="keyword">if</span>((sockfd = accept(server_listen, <span class="literal">NULL</span>, <span class="literal">NULL</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">"accept"</span>);</span><br><span class="line">            close(sockfd);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">pid_t</span> pid;</span><br><span class="line">        <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            perror(<span class="string">"fork"</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(pid == <span class="number">0</span>) &#123;</span><br><span class="line">        close(server_listen);</span><br><span class="line">        <span class="keyword">char</span> name[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(recv(sockfd, name, <span class="keyword">sizeof</span>(name), <span class="number">0</span>) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">           perror(<span class="string">"recv"</span>);</span><br><span class="line">            close(sockfd);</span><br><span class="line">         <span class="comment">// continue;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"name: %s\n"</span>, name);</span><br><span class="line">        close(sockfd);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    close(server_listen);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="client-c"><a href="#client-c" class="headerlink" title="client.c"></a>client.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sockfd, port;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server</span>;</span></span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Usage: %s ip port\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    port = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    server.sin_family = AF_INET;</span><br><span class="line">    server.sin_port = htons(port);</span><br><span class="line">    server.sin_addr.s_addr = inet_addr(argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((sockfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"socket"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     connect()用于建立与指定socket的连接。</span></span><br><span class="line"><span class="comment">     头文件: #include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="comment">     函数原型: int connect(SOCKET s, const struct sockaddr * name, int namelen);</span></span><br><span class="line"><span class="comment">    参数:</span></span><br><span class="line"><span class="comment">    s：标识一个未连接socket</span></span><br><span class="line"><span class="comment">    name：指向要连接套接字的sockaddr结构体的指针</span></span><br><span class="line"><span class="comment">    namelen：sockaddr结构体的字节长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Socket create.\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(connect(sockfd, (struct sockaddr *)&amp;server, <span class="keyword">sizeof</span>(server)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"connect"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     send（）是一个计算机函数，功能是向一个已经连接的socket发送数据</span></span><br><span class="line"><span class="comment">     int send( SOCKET s, const char FAR *buf, int len, int flags );</span></span><br><span class="line"><span class="comment">     不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。</span></span><br><span class="line"><span class="comment">    客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。</span></span><br><span class="line"><span class="comment">（1）第一个参数指定发送端套接字描述符；</span></span><br><span class="line"><span class="comment">（2）第二个参数指明一个存放应用程序要发送数据的缓冲区；</span></span><br><span class="line"><span class="comment">（3）第三个参数指明实际要发送的数据的字节数；</span></span><br><span class="line"><span class="comment">（4）第四个参数一般置0。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span>(send(sockfd, <span class="string">"fangsong"</span>, <span class="keyword">sizeof</span>(<span class="string">"fangsong"</span>), <span class="number">0</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"send"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(sockfd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
</div>
    <div class="footer" id="footer">
    <p><h4>Copyright © 2020 | Author: fangsong | Theme By <a class="theme-author" href="https://github.com/Xunzhuo/hexo-theme-coder" target="_blank" rel="noopener" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">Page Views: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">Unique Visitors: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="NOsswOncKgc8HOxqo9oxIWlX-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="z1FihjWEbS8uIfUQdmCtK7zz">
<script src="/libs/jquery.min.js"></script>
<script src="/libs/highlight/highlight.pack.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script src="/js/js.js"></script>
<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
